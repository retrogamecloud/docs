---
title: 7.2. GitHub Actions
description: Workflows automatizados de CI/CD con tests end-to-end
icon: github
---

## Workflows Implementados

RetroGame Cloud utiliza GitHub Actions para automatizar completamente el ciclo de vida del código desde commit hasta producción, incluyendo validación mediante tests end-to-end.

<CardGroup cols={3}>
  <Card title="docker-publish-and-update-k8s.yml" icon="docker">
    **Pipeline principal CI/CD**

    Build, test E2E, push Docker y actualizar manifiestos K8s

    *En todos los servicios*
  </Card>

  <Card title="ci.yml" icon="check">
    **Validación de manifiestos**

    Tests y validación de YAMLs de Kubernetes

    *Repo: kubernetes/*
  </Card>

  <Card title="e2e-tests.yml" icon="play">
    **Tests End-to-End**

    Validación de flujos completos de usuario

    *Todos los repos de servicios*
  </Card>

  <Card title="update-docs-with-claude.yml" icon="robot">
    **Actualización automática de docs**

    Claude AI actualiza la wiki/documentación

    *Repo: docs/*
  </Card>

  <Card title="deploy-mintlify-docs.yml" icon="book">
    **Despliegue de documentación**

    Deploy automático a Mintlify

    *Repo: docs/*
  </Card>

  <Card title="terraform-plan.yml" icon="code">
    **Validación de Terraform**

    Plan y validación de infraestructura

    *Repo: infrastructure/*
  </Card>

  <Card title="terraform-apply.yml" icon="rocket">
    **Despliegue de infraestructura**

    Apply de Terraform en producción

    *Repo: infrastructure/*
  </Card>
</CardGroup>

---

## Workflow Principal: Build & Deploy

Este es el workflow que se ejecuta en cada repositorio de servicio (frontend, auth, game-catalog, score, ranking, user).

### Estructura del Workflow

<CodeGroup>

```yaml Configuración
name: Compilar, Publicar y Actualizar Kubernetes

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '.gitignore'
  pull_request:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '.gitignore'

env:
  REGISTRY_GHCR: ghcr.io
  REGISTRY_DOCKERHUB: docker.io
  IMAGE_NAME: retrogamecloud/frontend  # Cambia por servicio
  K8S_REPO: retrogamecloud/kubernetes
  K8S_MANIFEST_FILE: 04-frontend.yaml  # Cambia por servicio
```

```yaml Jobs
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout código
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Instalar dependencias
        run: npm ci

      - name: Ejecutar tests unitarios
        run: npm test

      - name: Ejecutar linting
        run: npm run lint

  e2e-tests:
    runs-on: ubuntu-latest
    needs: build-and-test
    steps:
      - name: Checkout código
        uses: actions/checkout@v4

      - name: Setup cluster K8s efímero
        uses: helm/kind-action@v1.4.0

      - name: Deploy servicios mock
        run: |
          kubectl apply -f k8s/test/
          kubectl wait --for=condition=ready pod -l app=test-stack

      - name: Ejecutar tests E2E
        run: npm run test:e2e

  docker-publish:
    runs-on: ubuntu-latest
    needs: [build-and-test, e2e-tests]
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - name: Build y push Docker image
        # ... resto de la configuración
```

</CodeGroup>

---

## Tests End-to-End

### Herramientas Utilizadas

<CardGroup cols={2}>
  <Card title="Playwright" icon="play">
    **Tests de interfaz web**

    Automatización de navegador para flujos de usuario completos
  </Card>

  <Card title="Newman" icon="api">
    **Tests de API**

    Ejecución de collections de Postman para validar endpoints
  </Card>
</CardGroup>

### Escenarios Críticos Implementados

#### E2E-001: Flujo Completo de Jugador

<Steps>
  <Step title="Registro de usuario">
    Crear cuenta nueva con email y password válidos
  </Step>
  <Step title="Login y JWT">
    Autenticación exitosa y obtención de token
  </Step>
  <Step title="Catálogo de juegos">
    Listar juegos disponibles desde game-catalog service
  </Step>
  <Step title="Cargar juego">
    Inicializar emulador js-dos con ROM seleccionada
  </Step>
  <Step title="Guardar puntuación">
    Submit de score al servicio correspondiente
  </Step>
  <Step title="Verificar ranking">
    Comprobar aparición en leaderboard
  </Step>
</Steps>

#### E2E-002: Flujo de Autenticación OAuth2

<Steps>
  <Step title="Login con Google">
    Redirección a OAuth2 provider
  </Step>
  <Step title="Callback y JWT">
    Procesamiento de callback y generación de token
  </Step>
  <Step title="Recursos protegidos">
    Acceso exitoso a endpoints que requieren autenticación
  </Step>
</Steps>

### Configuración en CI

Los tests E2E se ejecutan automáticamente en GitHub Actions contra un cluster efímero de Kubernetes:

<CodeGroup>

```yaml Cluster Efímero
- name: Setup cluster K8s
  uses: helm/kind-action@v1.4.0
  with:
    cluster_name: retrogame-e2e
    config: |
      kind: Cluster
      apiVersion: kind.x-k8s.io/v1alpha4
      nodes:
      - role: control-plane
        kubeadmConfigPatches:
        - |
          kind: InitConfiguration
          nodeRegistration:
            kubeletExtraArgs:
              node-labels: "ingress-ready=true"
        extraPortMappings:
        - containerPort: 80
          hostPort: 80
        - containerPort: 443
          hostPort: 443
```

```yaml Servicios Mock
- name: Deploy test stack
  run: |
    # Auth service mock
    kubectl apply -f k8s/test/auth-mock.yaml
    
    # Database mock (PostgreSQL)
    kubectl apply -f k8s/test/postgres-test.yaml
    
    # Redis mock
    kubectl apply -f k8s/test/redis-test.yaml
    
    # Game catalog con ROMs de test
    kubectl apply -f k8s/test/game-catalog-mock.yaml
    
    # Esperar a que estén listos
    kubectl wait --for=condition=ready pod -l app=test-stack --timeout=300s
```

```yaml Ejecución Tests
- name: Ejecutar tests Playwright
  run: |
    export TEST_BASE_URL=http://localhost:80
    export TEST_API_URL=http://localhost:80/api
    npx playwright test --config=playwright.config.ci.js

- name: Ejecutar tests API Newman
  run: |
    newman run postman/RetroGame-E2E.postman_collection.json \
      --environment postman/test-environment.json \
      --reporters cli,junit \
      --reporter-junit-export results/api-tests.xml
```

</CodeGroup>

### Validaciones Críticas

<AccordionGroup>
  <Accordion title="Flujo de Juego Completo">
    - ✅ Carga correcta del emulador js-dos
    - ✅ Persistencia de estado de juego
    - ✅ Captura y envío de puntuación
    - ✅ Actualización en tiempo real del ranking
  </Accordion>

  <Accordion title="Seguridad y Autenticación">
    - ✅ Validación de tokens JWT
    - ✅ Expiración y renovación de sesión
    - ✅ Protección contra CSRF y XSS
    - ✅ Rate limiting en APIs
  </Accordion>

  <Accordion title="Performance y Escalabilidad">
    - ✅ Tiempo de carga < 3 segundos
    - ✅ Respuesta API < 500ms
    - ✅ Manejo de 100+ usuarios concurrentes
    - ✅ Carga de ROMs optimizada
  </Accordion>
</AccordionGroup>

<Note>
Los tests E2E son **bloqueantes** - ningún deployment llegará a producción si fallan las validaciones de flujo completo de usuario.
</Note>