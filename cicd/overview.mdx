---
title: 7.1. Visi√≥n General de CI/CD
description: Pipeline completo de integraci√≥n y despliegue continuo con GitHub Actions,
  Docker, ECR y ArgoCD con gates de aprobaci√≥n y rollback autom√°tico
icon: rocket
---

## Filosof√≠a CI/CD

Retro Game Hub implementa un pipeline completo de CI/CD que automatiza desde el commit hasta el despliegue en producci√≥n, siguiendo principios GitOps con zero-downtime deployments y mecanismos de rollback autom√°tico.

<CardGroup cols={3}>
  <Card title="Automatizaci√≥n Total" icon="robot">
    Desde commit hasta producci√≥n

    Pipeline completamente automatizado
  </Card>

  <Card title="GitOps" icon="code-branch">
    Git como fuente de verdad

    Declarativo e inmutable
  </Card>

  <Card title="Zero Downtime" icon="shield-halved">
    Rolling updates y health checks

    Rollback autom√°tico
  </Card>
</CardGroup>

## Pipeline Completo de CI/CD

El siguiente diagrama muestra el flujo completo desde el desarrollo hasta producci√≥n, incluyendo gates de aprobaci√≥n y mecanismos de rollback:

```mermaid
graph TB
    subgraph DEV["üíª DESARROLLO"]
        A[üë®‚Äçüíª Developer] -->|git push| B[üìÅ GitHub Repository]
        B --> B1[üîî Trigger Webhook]
    end

    subgraph CI["‚öôÔ∏è CONTINUOUS INTEGRATION - GitHub Actions"]
        B1 --> C1[üîç Lint & Format Check]
        C1 --> C2[üß™ Unit Tests]
        C2 --> C3[üîß Integration Tests]
        C3 --> C4[üõ°Ô∏è Security Scan]
        C4 --> D{‚úÖ All Tests Pass?}

        D -->|‚ùå Fail| STOP[üö´ Stop Pipeline<br/>Notify Developer]
        D -->|‚úÖ Success| E[üèóÔ∏è Build Docker Image]

        E --> F[üì¶ Multi-stage Build]
        F --> G[üîí Security Scan Image]
        G --> H[üì§ Push to AWS ECR]
        H --> I[üè∑Ô∏è Tag: latest, v1.0.X, sha-xxx]
    end

    subgraph GITOPS["üì¶ GITOPS WORKFLOW"]
        I --> J[üìù Update K8s Manifests]
        J --> K[‚öôÔ∏è Kustomize Build]
        K --> L[‚úÖ Validate Manifests]
        L --> M[üìã Create PR to Config Repo]

        M --> N{ü§ñ Auto-merge?}
        N -->|No| P[üëÄ Manual Review]
        N -->|Yes| O[üîÄ Auto-merge PR]
        P --> O
        O --> Q[üì¶ Config Repo Updated]
    end

    subgraph STAGING["üß™ STAGING DEPLOYMENT"]
        Q --> R[üîÑ ArgoCD Detects Change]
        R --> S[üöÄ Deploy to Staging]
        S --> T[‚ö° Rolling Update]
        T --> U[üè• Health Check]
        U --> V{üíö Staging Healthy?}
        
        V -->|‚ùå Fail| ROLLBACK_STG[‚è™ Rollback Staging]
        V -->|‚úÖ Success| W[üéØ E2E Tests]
        
        W --> X{üß™ E2E Pass?}
        X -->|‚ùå Fail| ROLLBACK_STG
        X -->|‚úÖ Success| Y[‚úÖ Staging Validated]
    end

    subgraph APPROVAL["üë• APPROVAL GATE"]
        Y --> Z{üõ°Ô∏è Manual Approval<br/>Required?}
        Z -->|No - Hotfix| AA[üö® Auto-promote]
        Z -->|Yes| BB[üë®‚Äçüíº Approval Request]
        BB --> CC{‚úÖ Approved?}
        CC -->|‚ùå Rejected| END1[‚õî Deployment Stopped]
        CC -->|‚úÖ Approved| AA
    end

    subgraph PROD["üåü PRODUCTION DEPLOYMENT"]
        AA --> DD[üéØ ArgoCD Sync to Prod]
        DD --> EE[üöÄ Rolling Update Prod]
        EE --> FF[üè• Health Check Prod]
        FF --> GG{üíö Production Healthy?}
        
        GG -->|‚ùå Fail| HH[üö® Auto Rollback Prod]
        GG -->|‚úÖ Success| II[üìä Post-deploy Monitoring]
        
        HH --> JJ[üîî Alert Team]
        II --> KK{üìà Metrics OK?}
        KK -->|‚ùå Degraded| HH
        KK -->|‚úÖ Success| LL[‚úÖ Deployment Complete]
    end

    subgraph MONITORING["üìä CONTINUOUS MONITORING"]
        LL --> MM[üìà Application Metrics]
        MM --> NN[üè• Health Checks]
        NN --> OO[üìã Log Aggregation]
        OO --> PP{üö® Issues Detected?}
        PP -->|Yes| QQ[üîî Alert & Consider Rollback]
        PP -->|No| RR[‚úÖ Stable Production]
    end

    style STOP fill:#ff6b6b
    style ROLLBACK_STG fill:#ffa726
    style HH fill:#ffa726
    style END1 fill:#ff6b6b
    style LL fill:#4caf50
    style RR fill:#4caf50
```

## Etapas Detalladas del Pipeline

### 1. Continuous Integration (CI)

<Steps>
  <Step title="Code Quality & Testing">
    - **Lint & Format**: ESLint, Prettier para frontend; gofmt, golint para backend
    - **Unit Tests**: Jest para React, Go test para APIs
    - **Integration Tests**: Testcontainers para bases de datos
    - **Security Scan**: SonarQube, Snyk para vulnerabilidades
  </Step>

  <Step title="Build & Package">
    - **Multi-stage Docker Build**: Optimizaci√≥n de capas e imagen final m√≠nima
    - **Security Scanning**: Trivy para escaneo de vulnerabilidades en imagen
    - **Registry Push**: AWS ECR con tags sem√°nticos y SHA commits
  </Step>
</Steps>

### 2. GitOps Workflow

<Steps>
  <Step title="Manifest Update">
    - Actualizaci√≥n autom√°tica de manifiestos Kubernetes
    - Validaci√≥n con Kustomize y Kubeval
    - Creaci√≥n de PR al repositorio de configuraci√≥n
  </Step>

  <Step title="Review Process">
    - Auto-merge para hotfixes y patches menores
    - Review manual para cambios mayores
    - Validaci√≥n de configuraci√≥n antes del merge
  </Step>
</Steps>

### 3. Deployment Stages

<Steps>
  <Step title="Staging Deployment">
    - **Autom√°tico**: ArgoCD detecta cambios y despliega
    - **Rolling Update**: Zero-downtime deployment
    - **E2E Testing**: Cypress para testing completo
    - **Rollback Autom√°tico**: Si health checks fallan
  </Step>

  <Step title="Approval Gate">
    - Configuraci√≥n por tipo de cambio (major/minor/patch)
    - Notificaciones a equipos de aprobaci√≥n
    - Bypass autom√°tico para hotfixes cr√≠ticos
  </Step>

  <Step title="Production Deployment">
    - **Rolling Update**: Actualizaci√≥n gradual de pods
    - **Health Checks**: Readiness y liveness probes
    - **Circuit Breaker**: Parada autom√°tica si falla
    - **Auto Rollback**: Retorno a versi√≥n anterior estable
  </Step>
</Steps>

### 4. Monitoring & Observability

<Tabs>
  <Tab title="Health Monitoring">
    ```yaml
    # Health check configuration
    readinessProbe:
      httpGet:
        path: /health/ready
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
      successThreshold: 1
      failureThreshold: 3

    livenessProbe:
      httpGet:
        path: /health/live
        port: 8080
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    ```
  </Tab>

  <Tab title="Rollback Strategy">
    ```bash
    # Automatic rollback triggers
    - Health check failures > 3 consecutive
    - Error rate > 5% for 2 minutes
    - Response time > 2s for 5 minutes
    - Critical alerts from monitoring

    # Rollback execution
    kubectl rollout undo deployment/retro-game-hub
    argocd app sync retro-game-hub --revision previous
    ```
  </Tab>

  <Tab title="Notification Channels">
    ```yaml
    # Alert configuration
    notifications:
      - trigger: deployment.failed
        channels: [slack, email, pagerduty]
      - trigger: rollback.executed
        channels: [slack, email]
      - trigger: approval.required
        channels: [slack, email]
    ```
  </Tab>
</Tabs>

## Configuraci√≥n de Gates y Pol√≠ticas

<CardGroup cols={2}>
  <Card title="Approval Policies" icon="shield-check">
    **Major Changes (v1.0.0 ‚Üí v2.0.0)**
    - Require manual approval
    - Security team review
    - Stakeholder sign-off

    **Minor Changes (v1.0.0 ‚Üí v1.1.0)**
    - Team lead approval
    - Automated after 2 hours

    **Patches (v1.0.0 ‚Üí v1.0.1)**
    - Auto-approve if tests pass
    - Immediate deployment
  </Card>

  <Card title="Rollback Triggers" icon="arrow-rotate-left">
    **Automatic Rollback**
    - Health check failures
    - Error rate spikes
    - Performance degradation
    - Critical security alerts

    **Manual Rollback**
    - Business decision
    - User feedback
    - Feature flag disable
  </Card>
</CardGroup>

## M√©tricas y SLOs

El pipeline mantiene los siguientes Service Level Objectives:

- **Lead Time**: < 30 minutos desde commit hasta staging
- **Deployment Frequency**: M√∫ltiples despliegues por d√≠a
- **MTTR (Mean Time To Recovery)**: < 15 minutos con rollback autom√°tico
- **Change Failure Rate**: < 5% con gates de calidad