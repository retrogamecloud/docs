{
  "analysis_summary": "La documentación tiene buena estructura base pero carece de guías operativas críticas, diagramas de infraestructura detallados y documentación de seguridad. Hay inconsistencias en nomenclatura y gaps importantes en monitorización, respaldos y procedimientos de emergencia.",
  "overall_score": 6.8,
  "improvements": [
    {
      "priority": "high",
      "category": "content",
      "title": "Documentación de Seguridad y Hardening",
      "description": "Falta documentación crítica sobre prácticas de seguridad, gestión de secretos, políticas de red en Kubernetes, configuración de RBAC y escaneo de vulnerabilidades. Es fundamental para producción.",
      "files_to_create": [
        "security/overview.mdx",
        "security/secrets-management.mdx",
        "security/network-policies.mdx",
        "security/rbac.mdx",
        "security/vulnerability-scanning.mdx"
      ],
      "files_to_modify": [
        "index.mdx"
      ],
      "files_to_delete": [],
      "proposed_content": "# Seguridad y Hardening\n\n## Gestión de Secretos\n- AWS Secrets Manager para credenciales de BD\n- Sealed Secrets en Kubernetes\n- Rotación automática de tokens JWT\n\n## Políticas de Red\n- NetworkPolicies para aislar microservicios\n- Reglas de entrada/salida por servicio\n- Segmentación de tráfico interno\n\n## RBAC en Kubernetes\n- Roles por servicio\n- ServiceAccounts con permisos mínimos\n- ClusterRoles para operadores",
      "mermaid_diagram": "",
      "rationale": "La seguridad es crítica en producción. Sin esta documentación, el sistema es vulnerable a ataques y no cumple con mejores prácticas de la industria."
    },
    {
      "priority": "high",
      "category": "diagrams",
      "title": "Diagrama de Arquitectura de Red AWS Completo",
      "description": "Crear diagrama detallado que muestre VPC, subnets públicas/privadas, NAT Gateways, Security Groups, y flujo de tráfico completo desde CloudFront hasta pods en EKS.",
      "files_to_create": [
        "infrastructure/network-architecture.mdx"
      ],
      "files_to_modify": [
        "infrastructure/networking.mdx"
      ],
      "files_to_delete": [],
      "proposed_content": "# Arquitectura de Red\n\nDiagrama completo de la infraestructura de red en AWS mostrando:\n- VPC con CIDR 10.0.0.0/16\n- 3 subnets públicas (AZ a,b,c)\n- 3 subnets privadas (AZ a,b,c)\n- Internet Gateway y NAT Gateways\n- ALB en subnets públicas\n- Nodos EKS en subnets privadas\n- Security Groups por capa",
      "mermaid_diagram": "graph TB subgraph Internet direction LR CF[CloudFront CDN] User[Usuario] end subgraph AWS_VPC[VPC 10.0.0.0/16] direction TB subgraph Public_Subnets[Subnets Públicas] IGW[Internet Gateway] ALB[Application Load Balancer] NAT1[NAT Gateway AZ-a] NAT2[NAT Gateway AZ-b] end subgraph Private_Subnets[Subnets Privadas] subgraph EKS_Cluster[Cluster EKS] Node1[Nodo Worker 1] Node2[Nodo Worker 2] Node3[Nodo Worker 3] subgraph Pods Kong[Kong Gateway] Auth[Auth Service] Catalog[Catalog Service] Score[Score Service] Rank[Ranking Service] end end RDS[(RDS PostgreSQL)] end end User -->|HTTPS| CF CF -->|HTTPS| ALB ALB --> Kong Kong --> Auth Kong --> Catalog Kong --> Score Kong --> Rank Auth --> RDS Catalog --> RDS Score --> RDS Rank --> RDS Node1 --> NAT1 Node2 --> NAT2 Node3 --> NAT1 NAT1 --> IGW NAT2 --> IGW IGW -->|Salida Internet| Internet style CF fill:#f96,stroke:#333 style ALB fill:#69f,stroke:#333 style Kong fill:#9f6,stroke:#333 style RDS fill:#f66,stroke:#333",
      "rationale": "La documentación actual de networking es superficial. Un diagrama completo es esencial para entender la arquitectura, troubleshooting y planificación de seguridad."
    },
    {
      "priority": "high",
      "category": "content",
      "title": "Guía de Monitorización y Observabilidad",
      "description": "Documentar stack completo de observabilidad: métricas con Prometheus, logs con Loki/CloudWatch, trazas distribuidas, dashboards en Grafana, alertas críticas y SLIs/SLOs.",
      "files_to_create": [
        "infrastructure/observability.mdx",
        "infrastructure/prometheus-setup.mdx",
        "infrastructure/logging.mdx",
        "infrastructure/alerting.mdx",
        "infrastructure/dashboards.mdx"
      ],
      "files_to_modify": [
        "infrastructure/monitoring.mdx"
      ],
      "files_to_delete": [],
      "proposed_content": "# Observabilidad\n\n## Stack de Monitorización\n- Prometheus para métricas de microservicios\n- Grafana para visualización\n- Loki para agregación de logs\n- Jaeger para trazas distribuidas\n\n## Métricas Clave\n- Latencia P95/P99 por endpoint\n- Tasa de errores HTTP 5xx\n- Saturación de CPU/Memoria por pod\n- Conexiones activas a BD\n\n## Alertas Críticas\n- Alta tasa de errores (>5% en 5min)\n- Latencia P95 >500ms\n- Pods en CrashLoopBackOff\n- BD con >80% conexiones",
      "mermaid_diagram": "graph LR subgraph Servicios Auth[Auth Service] Catalog[Catalog Service] Score[Score Service] end subgraph Recolección Prometheus[Prometheus] Loki[Loki] Jaeger[Jaeger Collector] end subgraph Visualización Grafana[Grafana] AlertManager[AlertManager] end subgraph Almacenamiento S3[S3 Logs] CloudWatch[CloudWatch] end Auth -->|métricas| Prometheus Auth -->|logs| Loki Auth -->|trazas| Jaeger Catalog -->|métricas| Prometheus Catalog -->|logs| Loki Catalog -->|trazas| Jaeger Score -->|métricas| Prometheus Score -->|logs| Loki Score -->|trazas| Jaeger Prometheus --> Grafana Loki --> Grafana Jaeger --> Grafana Prometheus --> AlertManager AlertManager -->|Slack/PagerDuty| Ops[Equipo Ops] Loki --> S3 Prometheus --> CloudWatch",
      "rationale": "Monitoring.mdx existe pero es muy básico. Una plataforma en producción necesita observabilidad completa para detectar problemas, debugging y optimización."
    },
    {
      "priority": "high",
      "category": "content",
      "title": "Procedimientos de Respaldo y Recuperación ante Desastres",
      "description": "Documentar estrategia completa de backups de BD, snapshots de volúmenes, procedimientos de restore, RPO/RTO, y planes de disaster recovery.",
      "files_to_create": [
        "operations/backup-strategy.mdx",
        "operations/disaster-recovery.mdx",
        "operations/restore-procedures.mdx"
      ],
      "files_to_modify": [],
      "files_to_delete": [],
      "proposed_content": "# Estrategia de Respaldos\n\n## Respaldos de Base de Datos\n- Snapshots automáticos de RDS cada 24h\n- Retención: 30 días\n- Respaldos manuales antes de cambios críticos\n- Exportación semanal a S3 para archivo\n\n## RPO/RTO\n- RPO: 24 horas (pérdida máxima de datos)\n- RTO: 2 horas (tiempo máximo de recuperación)\n\n## Procedimiento de Restore\n1. Identificar snapshot a restaurar\n2. Crear nueva instancia RDS desde snapshot\n3. Actualizar endpoints en servicios\n4. Verificar integridad de datos\n5. Redirigir tráfico",
      "mermaid_diagram": "graph TD A[Respaldo Automático] -->|Diario 02:00 UTC| B[Snapshot RDS] B --> C{Tipo} C -->|Automático| D[Retención 30 días] C -->|Manual| E[Retención Indefinida] B --> F[Exportar a S3] F --> G[Bucket Versionado] F --> H[Glacier después 90 días] I[Desastre] --> J[Identificar Snapshot] J --> K[Restaurar RDS] K --> L[Validar Datos] L --> M[Actualizar ConfigMaps] M --> N[Rolling Restart Pods] N --> O[Sistema Recuperado] style I fill:#f66,stroke:#333 style O fill:#6f6,stroke:#333",
      "rationale": "No hay documentación de backups ni DR. Es crítico para cumplir con SLAs, regulaciones y garantizar continuidad de negocio ante fallos."
    },
    {
      "priority": "high",
      "category": "diagrams",
      "title": "Diagrama de Flujo Completo de Juego",
      "description": "Crear diagrama de secuencia detallado mostrando el flujo completo desde que el usuario selecciona un juego hasta que lo juega, incluyendo autenticación, descarga de assets, inicialización de emulador y guardado de puntuaciones.",
      "files_to_create": [
        "frontend/game-flow-diagram.mdx"
      ],
      "files_to_modify": [
        "sequence-diagrams.mdx",
        "frontend/jsdos-integration.mdx"
      ],
      "files_to_delete": [],
      "proposed_content": "# Flujo Completo de Juego\n\nDiagrama de secuencia que muestra la interacción completa desde selección hasta finalización del juego, incluyendo carga de assets desde CloudFront, inicialización del emulador JS-DOS y guardado de puntuaciones.",
      "mermaid_diagram": "sequenceDiagram actor Usuario participant Frontend participant CloudFront participant Kong participant AuthService participant CatalogService participant ScoreService participant JSDOS as JS-DOS Emulator Usuario->>Frontend: Selecciona juego Frontend->>Kong: GET /api/games/{slug} Kong->>CatalogService: GET /games/{slug} CatalogService-->>Kong: Metadata del juego Kong-->>Frontend: Datos del juego + URL .jsdos Frontend->>CloudFront: GET /games/{slug}.jsdos CloudFront-->>Frontend: Archivo .jsdos (binario) Frontend->>JSDOS: Inicializar emulador(jsdos_file) JSDOS->>JSDOS: Descomprimir y cargar JSDOS-->>Frontend: Emulador listo Frontend->>JSDOS: Iniciar juego Usuario->>JSDOS: Juega Usuario->>Frontend: Finaliza juego (puntuación) Frontend->>Kong: POST /api/scores {game_id, score, jwt} Kong->>Kong: Validar JWT Kong->>ScoreService: POST /scores {user_id, game_id, score} ScoreService->>ScoreService: Verificar si es mejor puntuación ScoreService-->>Kong: Score guardado Kong-->>Frontend: Confirmación Frontend-->>Usuario: Puntuación guardada correctamente",
      "rationale": "Aunque existe sequence-diagrams.mdx, no documenta el flujo completo de juego con JS-DOS y CloudFront, que es el core de la plataforma."
    },
    {
      "priority": "medium",
      "category": "new_section",
      "title": "Guías de Operación y Runbooks",
      "description": "Crear sección completa con runbooks para operaciones comunes: escalado manual, rotación de secretos, actualización de servicios, debugging de pods, gestión de incidentes.",
      "files_to_create": [
        "operations/overview.mdx",
        "operations/runbooks/scaling.mdx",
        "operations/runbooks/secret-rotation.mdx",
        "operations/runbooks/service-update.mdx",
        "operations/runbooks/pod-debugging.mdx",
        "operations/runbooks/incident-response.mdx"
      ],
      "files_to_modify": [
        "index.mdx"
      ],
      "files_to_delete": [],
      "proposed_content": "# Runbooks de Operaciones\n\n## Escalado Manual de Servicios"
    }
  ]
}