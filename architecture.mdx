---
title: 2.1 Arquitectura del Sistema
description: VisiÃ³n general de la arquitectura de microservicios cloud-native de Retro
  Game Hub desplegada en AWS EKS, incluyendo decisiones arquitectÃ³nicas, infraestructura
  y justificaciones tÃ©cnicas
icon: sitemap
---

## VisiÃ³n General de la Arquitectura

Retro Game Hub estÃ¡ construido usando una arquitectura de microservicios cloud-native desplegada en AWS EKS (Kubernetes). La arquitectura sigue principios de escalabilidad, alta disponibilidad y separaciÃ³n de responsabilidades, organizÃ¡ndose en capas claramente definidas que aprovechan servicios gestionados de AWS para optimizar el rendimiento y reducir la complejidad operacional.

## Arquitectura de Alto Nivel

```mermaid
graph TB
    subgraph "INTERNET"
        Users[ğŸ‘¥ Users<br/>Global Traffic]
    end

    subgraph "AWS GLOBAL"
        subgraph "Route 53"
            DNS[ğŸŒ Route 53<br/>DNS Resolution<br/>retrogamehub.com]
        end

        subgraph "CloudFront Global"
            CDN[ğŸ“¡ CloudFront CDN<br/>Edge Locations<br/>Static Assets & Game Files]
        end
    end

    subgraph "AWS REGION: us-east-1"
        subgraph "VPC: 10.0.0.0/16"
            subgraph "Public Subnets"
                subgraph "AZ-1a: 10.0.1.0/24"
                    ALB1[âš–ï¸ Application Load Balancer<br/>SSL/TLS Termination<br/>Target Groups]
                    NAT1[ğŸ”„ NAT Gateway<br/>Outbound Internet]
                end

                subgraph "AZ-1b: 10.0.2.0/24"
                    NAT2[ğŸ”„ NAT Gateway<br/>Outbound Internet]
                end

                subgraph "AZ-1c: 10.0.3.0/24"
                    NAT3[ğŸ”„ NAT Gateway<br/>Outbound Internet]
                end
            end

            subgraph "Private Subnets - Application Tier"
                subgraph "App-AZ-1a: 10.0.10.0/24"
                    EKS1[â˜¸ï¸ EKS Worker Nodes<br/>Application Pods<br/>c5.large instances]
                end

                subgraph "App-AZ-1b: 10.0.20.0/24"
                    EKS2[â˜¸ï¸ EKS Worker Nodes<br/>Application Pods<br/>c5.large instances]
                end

                subgraph "App-AZ-1c: 10.0.30.0/24"
                    EKS3[â˜¸ï¸ EKS Worker Nodes<br/>Application Pods<br/>c5.large instances]
                end
            end

            subgraph "Private Subnets - Data Tier"
                subgraph "Data-AZ-1a: 10.0.100.0/24"
                    RDS1[ğŸ—„ï¸ RDS Primary<br/>PostgreSQL 14<br/>db.r5.xlarge]
                    REDIS1[âš¡ ElastiCache Primary<br/>Redis 7.0<br/>cache.r6g.large]
                end

                subgraph "Data-AZ-1b: 10.0.200.0/24"
                    RDS2[ğŸ—„ï¸ RDS Standby<br/>Multi-AZ Failover<br/>Auto Backup]
                    REDIS2[âš¡ ElastiCache Replica<br/>Read Scaling<br/>High Availability]
                end

                subgraph "Data-AZ-1c: 10.0.300.0/24"
                    S31[ğŸ“¦ S3 VPC Endpoint<br/>Game Assets Storage<br/>Private Connection]
                end
            end

            subgraph "Control Plane"
                EKSCP[ğŸ›ï¸ EKS Control Plane<br/>Managed by AWS<br/>Multi-AZ HA]
            end
        end

        subgraph "Additional AWS Services"
            S3[ğŸ“¦ S3 Buckets<br/>- Game Files<br/>- Static Assets<br/>- Logs & Backups]
            ACM[ğŸ” ACM Certificate<br/>SSL/TLS Management<br/>Auto Renewal]
            WAF[ğŸ›¡ï¸ AWS WAF<br/>DDoS Protection<br/>Security Rules]
            SECRETS[ğŸ”‘ Secrets Manager<br/>Database Credentials<br/>API Keys]
        end
    end

    %% Traffic Flow
    Users --> DNS
    DNS --> CDN
    CDN --> ALB1
    ALB1 --> EKS1
    ALB1 --> EKS2
    ALB1 --> EKS3
    
    EKS1 --> RDS1
    EKS2 --> RDS1
    EKS3 --> RDS1
    
    EKS1 --> REDIS1
    EKS2 --> REDIS1
    EKS3 --> REDIS1
    
    RDS1 -.-> RDS2
    REDIS1 -.-> REDIS2
    
    EKS1 --> S31
    EKS2 --> S31
    EKS3 --> S31
    
    CDN --> S3
    ALB1 --> WAF
    EKSCP --> EKS1
    EKSCP --> EKS2
    EKSCP --> EKS3

    %% Styling
    classDef aws fill:#FF9900,stroke:#FF6600,stroke-width:2px,color:#000
    classDef k8s fill:#326CE5,stroke:#1E88E5,stroke-width:2px,color:#fff
    classDef data fill:#4CAF50,stroke:#388E3C,stroke-width:2px,color:#fff
    classDef network fill:#9C27B0,stroke:#7B1FA2,stroke-width:2px,color:#fff
    classDef security fill:#F44336,stroke:#D32F2F,stroke-width:2px,color:#fff

    class DNS,CDN,S3,ACM,SECRETS,WAF aws
    class EKS1,EKS2,EKS3,EKSCP k8s
    class RDS1,RDS2,REDIS1,REDIS2 data
    class ALB1,NAT1,NAT2,NAT3,S31 network
    class WAF,ACM,SECRETS security
```

## Flujo de TrÃ¡fico Detallado

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ User
    participant R53 as ğŸŒ Route 53
    participant CF as ğŸ“¡ CloudFront
    participant WAF as ğŸ›¡ï¸ AWS WAF
    participant ALB as âš–ï¸ ALB
    participant ING as ğŸšª Ingress Controller
    participant SVC as ğŸ”„ K8s Service
    participant POD as ğŸ“¦ Application Pod
    participant REDIS as âš¡ ElastiCache
    participant RDS as ğŸ—„ï¸ PostgreSQL
    participant S3 as ğŸ“¦ S3

    User->>R53: 1. DNS Query (retrogamehub.com)
    R53-->>User: 2. CloudFront Distribution CNAME
    
    User->>CF: 3. HTTPS Request
    CF->>WAF: 4. Security Check
    WAF-->>CF: 5. Request Approved
    
    alt Static Content (CSS, JS, Images)
        CF->>S3: 6a. Fetch from S3 Origin
        S3-->>CF: 7a. Static Assets
        CF-->>User: 8a. Cached Response
    else Dynamic Content (API Calls)
        CF->>ALB: 6b. Forward to ALB Origin
        ALB->>ING: 7b. Route to Ingress
        ING->>SVC: 8b. Load Balance
        SVC->>POD: 9b. Forward Request
        
        POD->>REDIS: 10. Cache Lookup
        alt Cache Hit
            REDIS-->>POD: 11a. Return Cached Data
        else Cache Miss
            POD->>RDS: 11b. Database Query
            RDS-->>POD: 12b. Query Result
            POD->>REDIS: 13b. Update Cache
        end
        
        POD-->>SVC: 14. Response
        SVC-->>ING: 15. Response
        ING-->>ALB: 16. Response
        ALB-->>CF: 17. Response
        CF-->>User: 18. Final Response
    end
```

## Componentes de la Arquitectura

### Capa de Red y CDN

**Route 53**
- ResoluciÃ³n DNS global con health checks
- Routing policies para failover automÃ¡tico
- Subdominios para diferentes servicios (api.retrogamehub.com, cdn.retrogamehub.com)

**CloudFront CDN**
- 200+ edge locations globales
- Cache de contenido estÃ¡tico y assets de juegos
- CompresiÃ³n automÃ¡tica (Gzip/Brotli)
- IntegraciÃ³n con AWS WAF para protecciÃ³n DDoS

### Capa de Seguridad

**AWS WAF**
- ProtecciÃ³n contra ataques OWASP Top 10
- Rate limiting personalizado
- Geo-blocking y IP whitelisting
- Reglas personalizadas para gaming

**Application Load Balancer (ALB)**
- SSL/TLS termination con certificados ACM
- Health checks avanzados
- Target groups para diferentes servicios
- WebSocket support para features en tiempo real

### Capa de AplicaciÃ³n - EKS

**EKS Control Plane**
- Kubernetes 1.28 gestionado por AWS
- Multi-AZ para alta disponibilidad
- IntegraciÃ³n nativa con servicios AWS
- Actualizaciones automÃ¡ticas disponibles

**Worker Nodes**
- Auto Scaling Groups en mÃºltiples AZ
- Instancias c5.large optimizadas para compute
- Node groups separados por workload type
- Spot instances para workloads no crÃ­ticos

**Microservicios Principales**
```
ğŸ® game-service        â†’ GestiÃ³n de catÃ¡logo y metadatos
ğŸ‘¤ user-service        â†’ AutenticaciÃ³n y perfiles
ğŸ† achievement-service â†’ Sistema de logros y progreso
ğŸ’¬ social-service      â†’ Chat y features sociales
ğŸ” search-service      â†’ BÃºsqueda y recomendaciones
ğŸ“Š analytics-service   â†’ MÃ©tricas y telemetrÃ­a
ğŸš€ emulator-service    â†’ EjecuciÃ³n de juegos retro
```

### Capa de Datos

**Amazon RDS PostgreSQL**
- Multi-AZ deployment para alta disponibilidad
- Read replicas para scaling de lectura
- Automated backups y point-in-time recovery
- Performance Insights para monitoring

**ElastiCache Redis**
- Cluster mode habilitado para alta disponibilidad
- Session storage y application caching
- Pub/Sub para comunicaciÃ³n en tiempo real
- Automatic failover configurado

**Amazon S3**
- Buckets separados por tipo de contenido:
  - `retrogamehub-games`: ROMs y archivos de juego
  - `retrogamehub-assets`: ImÃ¡genes, videos, artwork
  - `retrogamehub-backups`: Backups de base de datos
  - `retrogamehub-logs`: Logs de aplicaciÃ³n y audit

### Justificaciones ArquitectÃ³nicas

**Â¿Por quÃ© EKS sobre EC2 directo?**
- OrquestaciÃ³n automÃ¡tica de contenedores
- Auto-scaling basado en mÃ©tricas personalizadas
- Declarative configuration con GitOps
- Mejor utilizaciÃ³n de recursos
- Facilita CI/CD y deployments blue-green

**Â¿Por quÃ© PostgreSQL sobre DynamoDB?**
- Relationships complejas entre usuarios, juegos, y achievements
- ACID compliance para transacciones crÃ­ticas
- SQL queries avanzadas para analytics
- Better tooling y ecosystem maduro

**Â¿Por quÃ© Redis como cache?**
- Sub-millisecond latency para gaming
- Data structures avanzadas (Sets, Sorted Sets)
- Pub/Sub para features en tiempo real
- Persistence opcional para session data

**Â¿Por quÃ© Multi-AZ deployment?**
- RTO < 2 minutos para database failover
- RPO < 1 minuto con continuous backup
- 99.99% availability SLA requirement
- Disaster recovery automÃ¡tico

## Escalabilidad y Performance

### Horizontal Pod Autoscaler (HPA)
```yaml
MÃ©tricas de scaling:
- CPU utilization > 70%
- Memory utilization > 80%
- Custom metrics (requests/second)
- Queue depth para processing jobs
```

### Vertical Pod Autoscaler (VPA)
- OptimizaciÃ³n automÃ¡tica de resource requests
- Historico de usage patterns
- Right-sizing de containers

### Cluster Autoscaler
- Escalado automÃ¡tico de worker nodes
- Scale-down de nodos infrautilizados
- Spot instance integration para cost optimization

## Monitoreo y Observabilidad

### CloudWatch Integration
- Container Insights para mÃ©tricas EKS
- Custom metrics desde aplicaciÃ³n
- Log aggregation centralizado
- Alertas proactivas configuradas

### Distributed Tracing
- AWS X-Ray para request tracing
- Latency analysis entre microservicios
- Performance bottleneck identification
- Error tracking y debugging

Esta arquitectura proporciona una base sÃ³lida, escalable y mantenible para Retro Game Hub, aprovechando las mejores prÃ¡cticas de cloud-native development y la robustez de los servicios gestionados de AWS.