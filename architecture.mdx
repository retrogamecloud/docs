---
title: Arquitectura del Sistema
sidebarTitle: 1.3. Arquitectura del Sistema
description: "Visi√≥n general de la arquitectura de microservicios cloud-native de Retro Game Hub desplegada en AWS EKS, incluyendo decisiones arquitect√≥nicas, infraestructura y justificaciones t√©cnicas"
icon: file-lines
---

## Visi√≥n General de la Arquitectura

Retro Game Hub est√° construido usando una arquitectura de microservicios cloud-native desplegada en AWS EKS (Kubernetes). La arquitectura sigue principios de escalabilidad, alta disponibilidad y separaci√≥n de responsabilidades, organiz√°ndose en capas claramente definidas que aprovechan servicios gestionados de AWS para optimizar el rendimiento y reducir la complejidad operacional.

## Arquitectura de Alto Nivel

<img src="/images/AWS.png" alt="Diagrama de arquitectura AWS de RetroGameCloud" style={{width: '100%', maxWidth: '1200px', margin: '20px auto', display: 'block'}} />

*Figura 1: Arquitectura completa del sistema desplegada en AWS, mostrando la distribuci√≥n de servicios en VPC, EKS, y servicios gestionados*

## Flujo de Tr√°fico y Conectividad

```mermaid
sequenceDiagram
    participant U as üë• User
    participant R53 as üåê Route 53
    participant CF as üì° CloudFront
    participant ALB as ‚öñÔ∏è ALB
    participant EKS as ‚ò∏Ô∏è EKS Pod
    participant RDS as üóÑÔ∏è Aurora
    participant REDIS as üöÄ Redis
    participant S3 as ü™£ S3

    Note over U,S3: Game Loading Flow

    U->>R53: DNS Query (retrogamehub.com)
    R53->>U: CloudFront IP Address
    
    U->>CF: HTTPS Request
    Note over CF: Edge Location Cache Check
    
    alt Static Assets (CSS/JS/Images)
        CF->>S3: Fetch from Origin (if cache miss)
        S3->>CF: Static Content
        CF->>U: Cached Content (Global Edge)
    else Dynamic API Requests
        CF->>ALB: Forward to Origin
        ALB->>EKS: Route to Available Pod
        
        Note over EKS: Microservice Processing
        
        EKS->>REDIS: Check Cache
        alt Cache Hit
            REDIS->>EKS: Return Cached Data
        else Cache Miss
            EKS->>RDS: Database Query
            RDS->>EKS: Query Results
            EKS->>REDIS: Update Cache
        end
        
        EKS->>ALB: API Response
        ALB->>CF: Forward Response
        CF->>U: Dynamic Content
    end

    Note over U,S3: Game File Download Flow
    U->>CF: Request Game ROM/Assets
    CF->>S3: Fetch Game Files (if not cached)
    S3->>CF: Game File Content
    CF->>U: Optimized Delivery
```

## Componentes Principales

### Capa de Red y Conectividad

- **Route 53**: DNS global con health checks y routing policies
- **CloudFront CDN**: 
  - 200+ edge locations globales
  - Cach√© de assets est√°ticos y archivos de juegos
  - Compresi√≥n autom√°tica y optimizaci√≥n
  - SSL/TLS termination

### Infraestructura de Compute

- **AWS EKS**: Kubernetes gestionado multi-AZ
  - Worker nodes distribuidos en 3 AZs
  - Auto Scaling Groups para elasticidad
  - Spot instances para cargas no cr√≠ticas
  - **Application Load Balancer**: 
    - SSL termination con AWS Certificate Manager
    - Target groups para microservicios
    - Health checks y routing inteligente

### Capa de Datos

- **Amazon Aurora PostgreSQL**:
  - Cluster multi-AZ con 1 writer y 2+ readers
  - Automatic failover en menos de 30 segundos
  - Continuous backup y point-in-time recovery

- **ElastiCache Redis**:
  - Cluster mode habilitado para sharding
  - Multi-AZ con automatic failover
  - Encryption in-transit y at-rest

### Almacenamiento y Assets

- **Amazon S3**:
  - Bucket para game files con versionado
  - Bucket para static assets con CloudFront integration
  - Intelligent Tiering para optimizaci√≥n de costos
  - **Amazon ECR**: Registry privado para im√°genes Docker

### Seguridad y Secrets Management

- **AWS Secrets Manager**: Rotaci√≥n autom√°tica de credenciales
- **IAM Roles**: Service accounts con OIDC integration
- **Security Groups**: Microsegmentaci√≥n de red
- **NACLs**: Capa adicional de seguridad de subnet

## Decisiones Arquitect√≥nicas Clave

### Multi-AZ para Alta Disponibilidad

Todos los componentes cr√≠ticos est√°n distribuidos en m√∫ltiples AZs:
- **RTO objetivo**: < 1 minuto para fallos de AZ
- **RPO objetivo**: < 5 minutos para p√©rdida de datos
- **Disponibilidad objetivo**: 99.9% uptime

### Separaci√≥n de Capas de Red

```
Public Subnets (10.0.1-3.0/24)     -> Internet-facing resources
Private App Subnets (10.0.10-30.0/24) -> EKS worker nodes  
Private Data Subnets (10.0.100-300.0/24) -> Databases
```

### Estrategia de Cach√© Multi-Nivel

1. **CloudFront**: Assets est√°ticos y game files
2. **Redis**: Datos de aplicaci√≥n y sesiones
3. **Aurora Read Replicas**: Query caching y read scaling

### Escalabilidad Autom√°tica

- **Cluster Autoscaler**: Nodos EKS basado en pod scheduling
- **HPA**: Pods basado en CPU/memoria
- **VPA**: Vertical scaling para optimizaci√≥n de recursos
- **Aurora Auto Scaling**: Read replicas basado en conexiones/CPU

## Justificaciones T√©cnicas

### ¬øPor qu√© EKS sobre ECS/Lambda?

1. **Complejidad de Microservicios**: 8+ servicios interconectados
2. **Portabilidad**: Kubernetes-native, avoid vendor lock-in
3. **Ecosistema**: Helm charts, operators, service mesh ready
4. **Scaling Granular**: Pod-level scaling vs container/function level

### ¬øPor qu√© Aurora sobre RDS MySQL?

1. **Performance**: 3x throughput vs MySQL
2. **Scaling**: Storage auto-scaling hasta 128TB
3. **Backups**: Continuous backup sin impacto en performance
4. **Global**: Aurora Global Database para DR futuro

### ¬øPor qu√© Redis sobre DynamoDB para Cach√©?

1. **Data Structures**: Support para gaming leaderboards, sets
2. **Pub/Sub**: Real-time notifications entre usuarios
3. **Lua Scripts**: Complex operations atomically
4. **Gaming Patterns**: Session storage, temporary data

## Monitoreo y Observabilidad

### M√©tricas Clave (CloudWatch)

- **Infrastructure**: CPU, memoria, network, disk de EKS nodes
- **Application**: Request latency, error rates, throughput
- **Database**: Aurora connections, query performance, lag
- **Cache**: Redis hit/miss ratios, memory usage

### Logging Strategy

- **Application Logs**: Fluent Bit -> CloudWatch Logs
- **Access Logs**: ALB -> S3 para analysis
- **Audit Logs**: EKS API calls -> CloudTrail
- **Database Logs**: Aurora slow query logs

### Alerting (CloudWatch Alarms)

- **Critical**: Database failover, EKS node failures
- **Warning**: High CPU/memory, elevated error rates  
- **Info**: Scaling events, deployment status

Esta arquitectura proporciona una base s√≥lida y escalable para Retro Game Hub, balanceando performance, disponibilidad y costos mientras mantiene la flexibilidad para evolucionar con los requerimientos del negocio.