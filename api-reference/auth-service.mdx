---
title: 1.4. Auth Service API
description: Endpoints de autenticaci√≥n, registro y gesti√≥n de tokens JWT
icon: shield
---

<Info>
  Documentaci√≥n generada autom√°ticamente desde el c√≥digo fuente.
  √öltima actualizaci√≥n: 2025-11-19
</Info>

<Warning>
  Esta es una p√°gina de ejemplo. Se sobrescribir√° cuando se ejecute la sincronizaci√≥n autom√°tica.
</Warning>

## Descripci√≥n General

El servicio de autenticaci√≥n maneja:

- üîê Registro de nuevos usuarios
- üé´ Inicio de sesi√≥n y generaci√≥n de tokens JWT
- ‚úÖ Verificaci√≥n de tokens
- üîÑ Renovaci√≥n de tokens (refresh)
- üîí Gesti√≥n de sesiones

## Base URL

```
Production:  https://api.retrogamehub.games/auth
Staging:     https://staging-api.retrogamehub.games/auth
Development: http://localhost:3001
```

## Autenticaci√≥n

Todos los endpoints (excepto `/register` y `/login`) requieren un token JWT v√°lido:

```bash
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

<Warning>
  Los tokens expiran despu√©s de 24 horas. Usa el endpoint de refresh para renovarlos.
</Warning>

---

## Endpoints

### POST /register

Registra un nuevo usuario en la plataforma.

**Request Body:**

```json
{
  "email": "player@example.com",
  "username": "retroPlayer",
  "password": "SecurePass123!"
}
```

**Validaciones:**
- Email debe ser v√°lido y √∫nico
- Username debe tener 3-20 caracteres alfanum√©ricos
- Password debe tener m√≠nimo 8 caracteres, incluir may√∫sculas, min√∫sculas, n√∫meros y s√≠mbolos

**Response 201:**

```json
{
  "success": true,
  "data": {
    "id": 123,
    "email": "player@example.com",
    "username": "retroPlayer",
    "createdAt": "2025-11-19T10:30:00Z"
  },
  "message": "Usuario registrado exitosamente"
}
```

**Errores:**

| C√≥digo | Descripci√≥n |
|--------|-------------|
| 400    | Email o username ya existe |
| 400    | Contrase√±a no cumple requisitos |
| 422    | Datos de entrada inv√°lidos |
| 500    | Error del servidor |

---

### POST /login

Autentica un usuario y genera tokens de acceso.

**Request Body:**

```json
{
  "email": "player@example.com",
  "password": "SecurePass123!"
}
```

**Response 200:**

```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 86400,
    "user": {
      "id": 123,
      "email": "player@example.com",
      "username": "retroPlayer",
      "role": "user"
    }
  },
  "message": "Login exitoso"
}
```

**Errores:**

| C√≥digo | Descripci√≥n |
|--------|-------------|
| 401    | Credenciales inv√°lidas |
| 403    | Cuenta bloqueada o inactiva |
| 429    | Demasiados intentos fallidos |
| 500    | Error del servidor |

---

### POST /refresh

Renueva un token de acceso usando el refresh token.

**Headers requeridos:**
```bash
Authorization: Bearer {refreshToken}
```

**Response 200:**

```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 86400
  },
  "message": "Token renovado exitosamente"
}
```

---

### POST /verify

Verifica la validez de un token JWT.

**Headers requeridos:**
```bash
Authorization: Bearer {token}
```

**Response 200:**

```json
{
  "success": true,
  "data": {
    "valid": true,
    "user": {
      "id": 123,
      "email": "player@example.com",
      "username": "retroPlayer",
      "role": "user"
    },
    "expiresAt": "2025-11-20T10:30:00Z"
  }
}
```

---

### POST /logout

Invalida el token actual y cierra la sesi√≥n.

**Headers requeridos:**
```bash
Authorization: Bearer {token}
```

**Response 200:**

```json
{
  "success": true,
  "message": "Logout exitoso"
}
```

---

### POST /forgot-password

Inicia el proceso de recuperaci√≥n de contrase√±a.

**Request Body:**

```json
{
  "email": "player@example.com"
}
```

**Response 200:**

```json
{
  "success": true,
  "message": "Email de recuperaci√≥n enviado"
}
```

---

### POST /reset-password

Restablece la contrase√±a usando un token de recuperaci√≥n.

**Request Body:**

```json
{
  "token": "reset_token_here",
  "newPassword": "NewSecurePass123!"
}
```

**Response 200:**

```json
{
  "success": true,
  "message": "Contrase√±a restablecida exitosamente"
}
```

---

## Modelos de Datos

### User

```typescript
interface User {
  id: number;
  email: string;
  username: string;
  role: 'user' | 'admin' | 'moderator';
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
  lastLoginAt?: string;
}
```

### JWT Token Payload

```typescript
interface JWTPayload {
  userId: number;
  email: string;
  username: string;
  role: string;
  iat: number;
  exp: number;
}
```

---

## C√≥digos de Error

| C√≥digo | Mensaje | Descripci√≥n |
|--------|---------|-------------|
| AUTH001 | Invalid credentials | Credenciales incorrectas |
| AUTH002 | Token expired | Token expirado |
| AUTH003 | Token invalid | Token inv√°lido o malformado |
| AUTH004 | User not found | Usuario no encontrado |
| AUTH005 | Account inactive | Cuenta desactivada |
| AUTH006 | Email already exists | Email ya registrado |
| AUTH007 | Username already exists | Username ya registrado |
| AUTH008 | Password too weak | Contrase√±a no cumple requisitos |
| AUTH009 | Too many attempts | Demasiados intentos fallidos |
| AUTH010 | Reset token invalid | Token de reset inv√°lido o expirado |

---

## Ejemplos de Uso

### Flujo de Registro y Login

```javascript
// 1. Registrar usuario
const registerResponse = await fetch('/auth/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'player@example.com',
    username: 'retroPlayer',
    password: 'SecurePass123!'
  })
});

// 2. Hacer login
const loginResponse = await fetch('/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'player@example.com',
    password: 'SecurePass123!'
  })
});

const { token, refreshToken } = await loginResponse.json();

// 3. Usar token en requests autenticados
const protectedResponse = await fetch('/api/protected', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### Renovaci√≥n de Token

```javascript
// Cuando el token expire, usar refresh token
const refreshResponse = await fetch('/auth/refresh', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${refreshToken}`
  }
});

const { token: newToken } = await refreshResponse.json();
```

---

## Seguridad

<Warning>
  **Importante:** Nunca almacenes tokens en localStorage en producci√≥n. Usa cookies httpOnly o sessionStorage.
</Warning>

- Los tokens JWT incluyen informaci√≥n del usuario pero no credenciales
- Los refresh tokens tienen mayor duraci√≥n (30 d√≠as) pero son de un solo uso
- Se implementa rate limiting en endpoints cr√≠ticos
- Las contrase√±as se hashean con bcrypt (cost factor: 12)
- Se registran todos los intentos de autenticaci√≥n para auditor√≠a