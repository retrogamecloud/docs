---
title: 8.3. Configuraci贸n de Entornos
description: Referencia completa de configuraci贸n para todos los servicios de Retro Game Hub
icon: file-lines
---

# 8.3. Configuraci贸n de Entornos

Esta secci贸n documenta todas las variables de configuraci贸n, par谩metros y ajustes disponibles en Retro Game Hub para diferentes entornos.

---

##  Variables de Entorno

### 8.3.1. Auth Service

Variables de entorno para el servicio de autenticaci贸n:

```bash
# Puerto del servicio
PORT=3001

# Entorno de ejecuci贸n
NODE_ENV=production

# Base de datos PostgreSQL
DB_HOST=retrogame-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=retrogamedb
DB_USER=postgres
DB_PASSWORD=<secret>

# JWT Configuration
JWT_SECRET=<generated-secret-key>
JWT_EXPIRATION=24h

# Redis para sesiones (opcional)
REDIS_HOST=redis-service
REDIS_PORT=6379
REDIS_PASSWORD=<secret>

# Rate Limiting
RATE_LIMIT_WINDOW=60000    # 1 minuto en ms
RATE_LIMIT_MAX_REQUESTS=10  # M谩ximo 10 requests/minuto

# CORS
CORS_ORIGIN=https://retrogamehub.games

# OAuth Providers
GOOGLE_CLIENT_ID=<google-client-id>
GOOGLE_CLIENT_SECRET=<google-client-secret>
GITHUB_CLIENT_ID=<github-client-id>
GITHUB_CLIENT_SECRET=<github-client-secret>

# Email Service
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=<email>
SMTP_PASS=<password>
```

#### Valores Recomendados por Entorno

| Variable | Development | Staging | Production |
|----------|-------------|---------|------------|
| `NODE_ENV` | `development` | `staging` | `production` |
| `JWT_EXPIRATION` | `7d` | `1h` | `24h` |
| `RATE_LIMIT_MAX_REQUESTS` | `100` | `50` | `10` |
| `DB_HOST` | `localhost` | RDS staging | RDS prod |
| `CORS_ORIGIN` | `http://localhost:3000` | `https://staging.retrogamehub.games` | `https://retrogamehub.games` |

---

### 8.3.2. User Service

```bash
# Puerto del servicio
PORT=3002

# Entorno
NODE_ENV=production

# Base de datos
DB_HOST=retrogame-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=retrogamedb
DB_USER=postgres
DB_PASSWORD=<secret>

# Validaci贸n de datos
USERNAME_MIN_LENGTH=3
USERNAME_MAX_LENGTH=20
EMAIL_VALIDATION_REGEX=^[^\s@]+@[^\s@]+\.[^\s@]+$
PASSWORD_MIN_LENGTH=8

# Avatar y archivos
DEFAULT_AVATAR_URL=https://cdn.retrogamehub.games/avatars/default.png
MAX_AVATAR_SIZE=5242880  # 5MB
ALLOWED_IMAGE_TYPES=jpg,jpeg,png,gif,webp

# Cache de perfiles (segundos)
PROFILE_CACHE_TTL=300  # 5 minutos

# S3 Configuration para avatares
AWS_ACCESS_KEY_ID=<access-key>
AWS_SECRET_ACCESS_KEY=<secret-key>
AWS_REGION=eu-west-1
S3_BUCKET_AVATARS=retrogame-avatars
```

---

### 8.3.3. Game Catalog Service

```bash
# Puerto del servicio
PORT=3003

# Entorno
NODE_ENV=production

# Base de datos
DB_HOST=retrogame-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=retrogamedb
DB_USER=postgres
DB_PASSWORD=<secret>

# APIs Externas
IGDB_CLIENT_ID=<igdb-client-id>
IGDB_CLIENT_SECRET=<igdb-client-secret>
RAWG_API_KEY=<rawg-api-key>
STEAM_API_KEY=<steam-api-key>

# Cache de datos
GAME_CACHE_TTL=3600    # 1 hora
SEARCH_CACHE_TTL=900   # 15 minutos
IMAGE_CACHE_TTL=86400  # 24 horas

# L铆mites de paginaci贸n
DEFAULT_PAGE_SIZE=20
MAX_PAGE_SIZE=100

# S3 Configuration para im谩genes de juegos
S3_BUCKET_GAMES=retrogame-games-media
CDN_BASE_URL=https://cdn.retrogamehub.games

# Indexaci贸n de b煤squeda
ELASTICSEARCH_URL=https://search-retrogame.eu-west-1.es.amazonaws.com
ELASTICSEARCH_INDEX=games
```

---

### 8.3.4. Review Service

```bash
# Puerto del servicio
PORT=3004

# Entorno
NODE_ENV=production

# Base de datos
DB_HOST=retrogame-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=retrogamedb
DB_USER=postgres
DB_PASSWORD=<secret>

# Validaci贸n de reviews
MIN_REVIEW_LENGTH=50
MAX_REVIEW_LENGTH=2000
RATING_MIN=1
RATING_MAX=5

# Moderaci贸n
ENABLE_PROFANITY_FILTER=true
PROFANITY_API_KEY=<profanity-api-key>
AUTO_MODERATE=true

# Notificaciones
NOTIFICATION_SERVICE_URL=http://notification-service:3006
ENABLE_EMAIL_NOTIFICATIONS=true

# Cache
REVIEW_CACHE_TTL=600   # 10 minutos
STATS_CACHE_TTL=1800   # 30 minutos
```

---

### 8.3.5. List Service

```bash
# Puerto del servicio
PORT=3005

# Entorno
NODE_ENV=production

# Base de datos
DB_HOST=retrogame-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=retrogamedb
DB_USER=postgres
DB_PASSWORD=<secret>

# L铆mites de listas
MAX_LISTS_PER_USER=50
MAX_GAMES_PER_LIST=1000
LIST_NAME_MAX_LENGTH=100
LIST_DESCRIPTION_MAX_LENGTH=500

# Tipos de lista predefinidos
DEFAULT_LIST_TYPES=wishlist,completed,currently_playing,dropped,favorites

# Cache
LIST_CACHE_TTL=300     # 5 minutos
USER_LISTS_CACHE_TTL=600  # 10 minutos

# Privacidad
DEFAULT_LIST_VISIBILITY=public
ALLOWED_VISIBILITIES=public,private,friends
```

---

### 8.3.6. Notification Service

```bash
# Puerto del servicio
PORT=3006

# Entorno
NODE_ENV=production

# Base de datos
DB_HOST=retrogame-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_PORT=5432
DB_NAME=retrogamedb
DB_USER=postgres
DB_PASSWORD=<secret>

# Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=<email>
SMTP_PASS=<password>
EMAIL_FROM=noreply@retrogamehub.games

# Push Notifications
FIREBASE_PROJECT_ID=retrogamehub
FIREBASE_PRIVATE_KEY=<private-key>
FIREBASE_CLIENT_EMAIL=<client-email>

# Configuraci贸n de notificaciones
MAX_NOTIFICATIONS_PER_USER=1000
NOTIFICATION_RETENTION_DAYS=90
BATCH_SIZE=100

# Rate limiting para emails
EMAIL_RATE_LIMIT=10  # emails por minuto por usuario
DAILY_EMAIL_LIMIT=50 # emails por d铆a por usuario
```

---

### 8.3.7. API Gateway

```bash
# Puerto del gateway
PORT=3000

# Entorno
NODE_ENV=production

# URLs de servicios
AUTH_SERVICE_URL=http://auth-service:3001
USER_SERVICE_URL=http://user-service:3002
GAME_SERVICE_URL=http://game-service:3003
REVIEW_SERVICE_URL=http://review-service:3004
LIST_SERVICE_URL=http://list-service:3005
NOTIFICATION_SERVICE_URL=http://notification-service:3006

# Rate Limiting Global
GLOBAL_RATE_LIMIT=1000    # requests por minuto
AUTHENTICATED_RATE_LIMIT=2000
PREMIUM_RATE_LIMIT=5000

# Timeouts
SERVICE_TIMEOUT=30000     # 30 segundos
GATEWAY_TIMEOUT=60000     # 60 segundos

# Load Balancing
ENABLE_CIRCUIT_BREAKER=true
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60000

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
ENABLE_REQUEST_LOGGING=true
```

---

##  Configuraci贸n de Base de Datos

### 8.3.8. PostgreSQL Principal

```yaml
# postgresql.conf principales configuraciones

# Conexiones
max_connections = 200
shared_buffers = 256MB
effective_cache_size = 1GB

# Logging
log_statement = 'mod'
log_min_duration_statement = 1000
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Performance
random_page_cost = 1.1
effective_io_concurrency = 200
work_mem = 4MB
maintenance_work_mem = 64MB

# Backup y replicaci贸n
wal_level = replica
max_wal_senders = 3
checkpoint_completion_target = 0.9
```

### ndices Recomendados

```sql
-- Usuarios
CREATE INDEX CONCURRENTLY idx_users_email ON users(email);
CREATE INDEX CONCURRENTLY idx_users_username ON users(username);
CREATE INDEX CONCURRENTLY idx_users_created_at ON users(created_at);

-- Juegos
CREATE INDEX CONCURRENTLY idx_games_title ON games USING GIN(to_tsvector('english', title));
CREATE INDEX CONCURRENTLY idx_games_release_date ON games(release_date);
CREATE INDEX CONCURRENTLY idx_games_rating ON games(average_rating);

-- Reviews
CREATE INDEX CONCURRENTLY idx_reviews_game_user ON reviews(game_id, user_id);
CREATE INDEX CONCURRENTLY idx_reviews_created_at ON reviews(created_at);
CREATE INDEX CONCURRENTLY idx_reviews_rating ON reviews(rating);

-- Listas
CREATE INDEX CONCURRENTLY idx_lists_user_id ON lists(user_id);
CREATE INDEX CONCURRENTLY idx_list_games_list_game ON list_games(list_id, game_id);
```

---

## 锔 Configuraci贸n AWS

### 8.3.9. ECS Task Definitions

```json
{
  "family": "retrogame-auth-service",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "executionRoleArn": "arn:aws:iam::account:role/ecsTaskExecutionRole",
  "taskRoleArn": "arn:aws:iam::account:role/ecsTaskRole",
  "containerDefinitions": [
    {
      "name": "auth-service",
      "image": "retrogamehub/auth-service:latest",
      "essential": true,
      "portMappings": [
        {
          "containerPort": 3001,
          "protocol": "tcp"
        }
      ],
      "environment": [
        {
          "name": "NODE_ENV",
          "value": "production"
        }
      ],
      "secrets": [
        {
          "name": "DB_PASSWORD",
          "valueFrom": "arn:aws:ssm:region:account:parameter/retrogame/db/password"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/retrogame-auth",
          "awslogs-region": "eu-west-1",
          "awslogs-stream-prefix": "ecs"
        }
      }
    }
  ]
}
```

### 8.3.10. RDS Configuration

```yaml
# Variables para RDS
Engine: postgres
EngineVersion: "14.9"
DBInstanceClass: db.t3.micro  # Para desarrollo
                 db.r5.large  # Para producci贸n
AllocatedStorage: 100
StorageType: gp2
StorageEncrypted: true
MultiAZ: true  # Solo producci贸n
BackupRetentionPeriod: 7
PreferredBackupWindow: "03:00-04:00"
PreferredMaintenanceWindow: "Sun:04:00-Sun:05:00"

# Parameter Group personalizado
shared_preload_libraries: 'pg_stat_statements'
log_statement: 'mod'
log_min_duration_statement: 1000
```

---

##  Monitoreo y Logging

### 8.3.11. CloudWatch Configuration

```yaml
# M茅tricas personalizadas
CustomMetrics:
  - MetricName: "API_Requests"
    Namespace: "RetroGameHub/API"
    Dimensions:
      - Name: "Service"
        Value: "${SERVICE_NAME}"
  
  - MetricName: "Database_Connections"
    Namespace: "RetroGameHub/Database"
    
  - MetricName: "Cache_Hit_Rate"
    Namespace: "RetroGameHub/Cache"

# Alarmas
Alarms:
  - AlarmName: "High-CPU-Usage"
    MetricName: "CPUUtilization"
    Threshold: 80
    ComparisonOperator: "GreaterThanThreshold"
    
  - AlarmName: "High-Memory-Usage"
    MetricName: "MemoryUtilization"
    Threshold: 85
    ComparisonOperator: "GreaterThanThreshold"
```

### Log Configuration

```json
{
  "version": "0",
  "timestamp": true,
  "level": "info",
  "format": "json",
  "transports": {
    "console": {
      "colorize": true
    },
    "cloudwatch": {
      "logGroup": "/retrogamehub/services",
      "logStream": "${SERVICE_NAME}-${INSTANCE_ID}",
      "region": "eu-west-1"
    }
  }
}
```

---

##  Variables por Entorno

### 8.3.12. Development

```bash
# .env.development
NODE_ENV=development
LOG_LEVEL=debug
ENABLE_CORS=true
CORS_ORIGIN=http://localhost:3000

# Base de datos local
DB_HOST=localhost
DB_PORT=5432
DB_NAME=retrogamedev
DB_USER=postgres
DB_PASSWORD=postgres

# Desactivar rate limiting en desarrollo
RATE_LIMIT_MAX_REQUESTS=1000

# Hot reload
ENABLE_HOT_RELOAD=true
WATCH_FILES=true
```

### 8.3.13. Staging

```bash
# .env.staging
NODE_ENV=staging
LOG_LEVEL=info
ENABLE_DETAILED_LOGGING=true

# Base de datos staging
DB_HOST=retrogame-staging-db.xxxxx.eu-west-1.rds.amazonaws.com
DB_NAME=retrogamestaging

# Rate limiting moderado
RATE_LIMIT_MAX_REQUESTS=50

# Testing features
ENABLE_FEATURE_FLAGS=true
FEATURE_FLAG_SERVICE=http://feature-flags:8080
```

### 8.3.14. Production

```bash
# .env.production
NODE_ENV=production
LOG_LEVEL=warn
ENABLE_PERFORMANCE_MONITORING=true

# Optimizaciones de producci贸n
ENABLE_COMPRESSION=true
ENABLE_CACHING=true
CACHE_MAX_AGE=3600

# Seguridad adicional
HELMET_ENABLED=true
HSTS_MAX_AGE=31536000
CONTENT_SECURITY_POLICY=strict

# Rate limiting estricto
RATE_LIMIT_MAX_REQUESTS=10
ENABLE_IP_WHITELIST=false
```

---

##  Checklist de Configuraci贸n

### Antes del Deploy

- [ ] Todas las variables de entorno est谩n definidas
- [ ] Secretos almacenados en AWS Parameter Store/Secrets Manager
- [ ] Configuraci贸n de base de datos validada
- [ ] Certificados SSL/TLS configurados
- [ ] Rate limiting apropiado por entorno
- [ ] Logs configurados correctamente
- [ ] M茅tricas y alarmas activas
- [ ] Backup autom谩tico configurado
- [ ] Variables de feature flags definidas
- [ ] CORS configurado por entorno

### Post-Deploy

- [ ] Health checks funcionando
- [ ] M茅tricas reportando correctamente
- [ ] Logs visibles en CloudWatch
- [ ] Base de datos accesible
- [ ] Cache funcionando
- [ ] APIs externas conectadas
- [ ] Notificaciones funcionando
- [ ] Rate limiting efectivo

---

*Para m谩s detalles sobre deployment, consulta la [secci贸n 7.5](./deployment.mdx).*
*Para configuraci贸n de desarrollo local, ve a la [secci贸n 8.1](./desarrollo-local.mdx).*