---
title: 6.1. Visi贸n General de Infraestructura
description: Infraestructura cloud AWS gestionada con Terraform para alta disponibilidad y escalabilidad
icon: file-lines
---

## Infraestructura como C贸digo

La infraestructura de Retro Game Hub est谩 completamente gestionada con **Terraform**, asegurando despliegues reproducibles y versionados en AWS.

## Arquitectura de la Infraestructura

<div className="mermaid">
```mermaid
graph TB
    subgraph "Internet"
        Users[ Usuarios]
        GitHub[GitHub OAuth]
    end
    
    subgraph "AWS Cloud"
        subgraph "Route53 + CloudFront"
            DNS[Route53<br/>retrogamehub.games]
            CDN[CloudFront CDN<br/>Assets & Contenido]
        end
        
        subgraph "VPC (10.0.0.0/16)"
            subgraph "Public Subnets"
                ALB[Application Load Balancer]
                NAT1[NAT Gateway AZ-1]
                NAT2[NAT Gateway AZ-2]
                IGW[Internet Gateway]
            end
            
            subgraph "Private Subnets - AZ1"
                EKS1[EKS Worker Nodes]
                RDS_PRIMARY[(RDS PostgreSQL<br/>Primary)]
            end
            
            subgraph "Private Subnets - AZ2" 
                EKS2[EKS Worker Nodes]
                RDS_STANDBY[(RDS PostgreSQL<br/>Standby)]
                REDIS[(ElastiCache Redis)]
            end
            
            subgraph "EKS Control Plane"
                CONTROL[EKS Managed Control Plane]
                NGINX[Ingress NGINX]
                OAUTH[OAuth2-Proxy]
            end
        end
        
        subgraph "Storage & Logs"
            S3[S3 Buckets<br/>Logs & Artifacts]
        end
        
        subgraph "Security & Access"
            ACM[ACM Certificates]
            IAM[IAM Roles & Policies]
            SG[Security Groups]
        end
    end
    
    Users --> DNS
    DNS --> CDN
    CDN --> ALB
    GitHub --> OAUTH
    ALB --> NGINX
    NGINX --> OAUTH
    OAUTH --> EKS1
    OAUTH --> EKS2
    EKS1 --> RDS_PRIMARY
    EKS2 --> RDS_PRIMARY
    EKS1 --> REDIS
    EKS2 --> REDIS
    RDS_PRIMARY --> RDS_STANDBY
    EKS1 --> S3
    EKS2 --> S3
    NAT1 --> IGW
    NAT2 --> IGW
    EKS1 --> NAT1
    EKS2 --> NAT2
    
    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef k8s fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef database fill:#336791,stroke:#fff,stroke-width:2px,color:#fff
    classDef security fill:#DD344C,stroke:#fff,stroke-width:2px,color:#fff
    
    class DNS,CDN,ALB,NAT1,NAT2,IGW,S3,ACM,IAM aws
    class CONTROL,EKS1,EKS2,NGINX,OAUTH k8s
    class RDS_PRIMARY,RDS_STANDBY,REDIS database
    class SG security
```
</div>

## Componentes de Red y Seguridad

### Red VPC
- **CIDR:** `10.0.0.0/16`
- **Subnets P煤blicas:** 2 AZ con NAT Gateways e Internet Gateway
- **Subnets Privadas:** 2 AZ para workloads y bases de datos
- **Multi-AZ:** Alta disponibilidad en `us-west-2a` y `us-west-2b`

### Security Groups
- **ALB-SG:** Puertos 80/443 desde internet
- **EKS-SG:** Comunicaci贸n interna del cluster
- **RDS-SG:** Puerto 5432 solo desde EKS nodes
- **Redis-SG:** Puerto 6379 solo desde EKS nodes

## Servicios AWS Utilizados

<CardGroup cols={2}>
  <Card title="EKS" icon="dharmachakra">
    Cluster Kubernetes gestionado para orquestaci贸n de contenedores
  </Card>
  <Card title="VPC" icon="network-wired">
    Red aislada con subnets p煤blicas y privadas multi-AZ
  </Card>
  <Card title="RDS" icon="database">
    PostgreSQL 14 con Multi-AZ y backups autom谩ticos
  </Card>
  <Card title="ElastiCache" icon="bolt">
    Redis 7.x gestionado para cach茅 y sesiones
  </Card>
  <Card title="ALB" icon="scale-balanced">
    Application Load Balancer con terminaci贸n SSL
  </Card>
  <Card title="Route53" icon="globe">
    Gesti贸n DNS para retrogamehub.games
  </Card>
  <Card title="CloudFront" icon="cloud">
    CDN para assets de juegos y contenido est谩tico
  </Card>
  <Card title="S3" icon="bucket">
    Almacenamiento de objetos para archivos y logs
  </Card>
  <Card title="ACM" icon="certificate">
    Certificados SSL/TLS autom谩ticos
  </Card>
  <Card title="IAM" icon="shield">
    Gesti贸n de identidad y acceso con roles espec铆ficos
  </Card>
  <Card title="Ingress NGINX" icon="route">
    Routing interno con balanceo de carga
  </Card>
  <Card title="OAuth2-Proxy" icon="lock">
    Autenticaci贸n GitHub para servicios de monitoreo
  </Card>
</CardGroup>

## Flujo de Tr谩fico

<Steps>
  <Step title="DNS Resolution">
    Route53 resuelve `retrogamehub.games` y subdominios
  </Step>
  <Step title="CDN Distribution">
    CloudFront sirve contenido est谩tico y cachea responses
  </Step>
  <Step title="Load Balancing">
    ALB distribuye tr谩fico entre AZ con health checks
  </Step>
  <Step title="Ingress Routing">
    NGINX Ingress enruta requests a servicios espec铆ficos
  </Step>
  <Step title="Authentication">
    OAuth2-Proxy valida acceso para servicios protegidos
  </Step>
  <Step title="Application Processing">
    Pods de Kubernetes procesan requests con acceso a RDS/Redis
  </Step>
</Steps>

## Estructura de Terraform

```bash
terraform/eks_test/
 main.tf                  # Configuraci贸n del provider AWS
 variables.tf             # Variables de entrada y configuraci贸n
 outputs.tf               # Valores de salida para otros m贸dulos
 vpc.tf                   # VPC, subnets, IGW y NAT gateways
 eks.tf                   # Cluster EKS y node groups
 rds.tf                   # PostgreSQL Multi-AZ con backups
 elasticache.tf           # Redis cluster configuration
 s3.tf                    # Buckets S3 y CloudFront distribution
 route53.tf               # DNS records y health checks
 alb.tf                   # Application Load Balancer
 security-groups.tf       # Security groups y reglas
 iam.tf                   # Roles y policies IAM
 acm.tf                   # SSL certificates
```

## Caracter铆sticas de Alta Disponibilidad

- **Multi-AZ Deployment:** Recursos distribuidos en 2 zonas de disponibilidad
- **Auto Scaling:** EKS node groups con escalado autom谩tico
- **Database Failover:** RDS Multi-AZ con failover autom谩tico
- **Load Balancing:** ALB con health checks y distribuci贸n inteligente
- **CDN Global:** CloudFront para baja latencia mundial
- **Backup Automatizado:** RDS snapshots diarios y retenci贸n configurable

<Note>
  La infraestructura est谩 dise帽ada para soportar fallos de componentes individuales sin interrumpir el servicio.
</Note>