---
title: 4.1. Visi贸n General de Infraestructura
description: Infraestructura cloud AWS gestionada con Terraform para alta disponibilidad
  y escalabilidad
icon: file-lines
---

## 4.1. Infraestructura como C贸digo

La infraestructura de Retro Game Hub est谩 completamente gestionada con **Terraform**, asegurando despliegues reproducibles y versionados en AWS.

## 4.1.1. Arquitectura de la Infraestructura

<div className="mermaid">

```mermaid
graph TB
    subgraph "Internet"
        Users[ Usuarios]
        GitHub[GitHub OAuth]
    end

    subgraph "AWS Cloud"
        subgraph "Route53 + CloudFront"
            DNS[Route53<br/>retrogamehub.games]
            CDN[CloudFront CDN<br/>Assets & Contenido]
        end

        subgraph "VPC (10.0.0.0/16)"
            subgraph "Public Subnets"
                ALB[Application Load Balancer]
                NAT1[NAT Gateway AZ-1]
                NAT2[NAT Gateway AZ-2]
                IGW[Internet Gateway]
            end

            subgraph "Private Subnets - AZ1"
                EKS1[EKS Worker Nodes]
                RDS_PRIMARY[(RDS PostgreSQL<br/>Primary)]
            end

            subgraph "Private Subnets - AZ2"
                EKS2[EKS Worker Nodes]
                RDS_STANDBY[(RDS PostgreSQL<br/>Standby)]
                REDIS[(ElastiCache Redis)]
            end

            subgraph "EKS Control Plane"
                CONTROL[EKS Managed Control Plane]
                NGINX[Ingress NGINX]
                OAUTH[OAuth2-Proxy]
            end
        end

        subgraph "Storage & Logs"
            S3[S3 Buckets<br/>Logs & Artifacts]
        end

        subgraph "Security & Access"
            ACM[ACM Certificates]
            IAM[IAM Roles & Policies]
            SG[Security Groups]
        end
    end

    Users --> DNS
    DNS --> CDN
    CDN --> ALB
    GitHub --> OAUTH
    ALB --> NGINX
    NGINX --> OAUTH
    OAUTH --> EKS1
    OAUTH --> EKS2
    EKS1 --> RDS_PRIMARY
    EKS2 --> RDS_PRIMARY
    EKS1 --> REDIS
    EKS2 --> REDIS
    RDS_PRIMARY --> RDS_STANDBY

    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef k8s fill:#326CE5,stroke:#fff,stroke-width:2px,color:#fff
    classDef db fill:#336791,stroke:#fff,stroke-width:2px,color:#fff
    classDef users fill:#28a745,stroke:#fff,stroke-width:2px,color:#fff

    class DNS,CDN,ALB,S3,ACM,IAM,SG,NAT1,NAT2,IGW aws
    class EKS1,EKS2,CONTROL,NGINX,OAUTH k8s
    class RDS_PRIMARY,RDS_STANDBY,REDIS db
    class Users users

```

</div>

## 4.1.2. Principios de Dise帽o

### 4.1.2.1. Alta Disponibilidad

- **Multi-AZ**: Despliegue en m煤ltiples zonas de disponibilidad

- **Auto-scaling**: Escalado autom谩tico de nodos EKS

- **Health Checks**: Monitoreo continuo de la salud de los servicios

- **Failover**: Conmutaci贸n autom谩tica en caso de fallos

### 4.1.2.2. Escalabilidad

- **Horizontal Scaling**: Pods y nodos se escalan seg煤n demanda

- **Elastic Load Balancing**: Distribuci贸n autom谩tica del tr谩fico

- **Resource Optimization**: Configuraci贸n optimizada de recursos

- **Performance Monitoring**: M茅tricas para optimizaci贸n continua

### 4.1.2.3. Seguridad

- **Network Isolation**: VPC con subnets p煤blicas y privadas

- **IAM Least Privilege**: Permisos m铆nimos necesarios

- **Encryption**: Cifrado en tr谩nsito y en reposo

- **Security Groups**: Reglas de firewall granulares

## 4.1.3. Componentes Principales

### 4.1.3.1. Capa de Red

- **VPC**: Red privada virtual aislada (10.0.0.0/16)

- **Subnets**: Segmentaci贸n en subredes p煤blicas y privadas

- **Internet Gateway**: Acceso a internet para recursos p煤blicos

- **NAT Gateways**: Acceso saliente para recursos privados

### 4.1.3.2. Capa de Computaci贸n

- **EKS Cluster**: Kubernetes gestionado por AWS

- **Worker Nodes**: Instancias EC2 optimizadas para contenedores

- **Auto Scaling Groups**: Escalado autom谩tico de nodos

- **Spot Instances**: Optimizaci贸n de costos con instancias spot

### 4.1.3.3. Capa de Datos

- **RDS PostgreSQL**: Base de datos relacional con Multi-AZ

- **ElastiCache Redis**: Cache en memoria para sesiones

- **S3 Buckets**: Almacenamiento de objetos para logs y artifacts

### 4.1.3.4. Capa de Aplicaci贸n

- **Application Load Balancer**: Balanceador de carga de aplicaci贸n

- **Ingress NGINX**: Controlador de ingreso para Kubernetes

- **OAuth2-Proxy**: Autenticaci贸n y autorizaci贸n

- **CloudFront**: CDN para optimizaci贸n de contenido

## 4.1.4. Gesti贸n y Operaciones

### 4.1.4.1. Infrastructure as Code

```hcl

# Ejemplo de configuraci贸n Terraform
module "vpc" {
  source = "./modules/vpc"

  cidr_block           = "10.0.0.0/16"
  availability_zones   = ["us-west-2a", "us-west-2b"]
  public_subnet_cidrs  = ["10.0.1.0/24", "10.0.2.0/24"]
  private_subnet_cidrs = ["10.0.3.0/24", "10.0.4.0/24"]

  tags = local.common_tags
}

```

### 4.1.4.2. Monitoreo y Logging

- **CloudWatch**: M茅tricas y logs centralizados

- **Prometheus**: M茅tricas de aplicaci贸n y Kubernetes

- **Grafana**: Dashboards y visualizaci贸n

- **ELK Stack**: Agregaci贸n y an谩lisis de logs

### 4.1.4.3. Backup y Recuperaci贸n

- **Automated Backups**: Snapshots autom谩ticos de RDS

- **Cross-Region Replication**: Replicaci贸n de S3 entre regiones

- **Disaster Recovery**: Plan de recuperaci贸n ante desastres

- **RTO/RPO**: Objetivos de tiempo y punto de recuperaci贸n definidos

## 4.1.5. Costos y Optimizaci贸n

### 4.1.5.1. Estrategias de Optimizaci贸n

- **Reserved Instances**: Reserva de instancias para cargas predecibles

- **Spot Instances**: Uso de instancias spot para cargas tolerantes a fallos

- **Auto Scaling**: Escalado basado en m茅tricas de utilizaci贸n

- **Resource Tagging**: Etiquetado para seguimiento de costos

### 4.1.5.2. Estimaci贸n de Costos
| Componente | Costo Mensual Estimado | Descripci贸n |
|------------|----------------------|-------------|
| EKS Cluster | $72 | Control plane gestionado |
| EC2 Instances | $150-300 | 3-6 nodos t3.medium |
| RDS PostgreSQL | $120 | db.t3.micro Multi-AZ |
| ElastiCache | $50 | cache.t3.micro |
| Load Balancer | $20 | Application Load Balancer |
| **Total** | **$412-562** | Estimaci贸n mensual |

<Callout type="info">
Los costos pueden variar seg煤n el uso real, regi贸n de AWS y configuraciones espec铆ficas.
</Callout>

## 4.1.6. Siguientes Pasos

Para implementar y gestionar esta infraestructura, consulta las siguientes secciones:

- **[4.2. Configuraci贸n de AWS](./aws-setup)**: Setup inicial de la cuenta AWS

- **[4.3. Terraform](./terraform)**: Configuraci贸n y despliegue con Terraform

- **[4.4. Kubernetes](./kubernetes)**: Configuraci贸n del cluster EKS

- **[4.5. Monitoreo](./monitoring)**: Setup de monitoreo y alertas

- **[4.6. Seguridad](./security)**: Implementaci贸n de medidas de seguridad