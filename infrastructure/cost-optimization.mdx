---
title: 4.10. Optimización de Costos AWS
sidebarTitle: 5.11. Optimización de Costos
description: Guía completa para monitorizar y optimizar los costos operativos de RetroGameCloud
  en AWS
icon: coins
---

# 4.10. Optimización de Costos AWS

Esta guía proporciona estrategias específicas para optimizar los costos de infraestructura de RetroGameCloud, incluyendo análisis detallado de gastos por servicio y recomendaciones de ahorro.

## 4.10.1. Análisis de Costos por Servicio

### Breakdown de Costos Actual

<Tabs>
<Tab title="EKS y Compute">

* *Amazon EKS Cluster**

- Control Plane: $73/mes por cluster

- Worker Nodes (3x t3.medium): ~$65/mes

- Load Balancer: ~$18/mes

- **Total EKS**: ~$156/mes

* *Potencial de Ahorro**: 40-70% con Reserved/Spot Instances
</Tab>
<Tab title="RDS PostgreSQL">

* *Base de Datos**

- RDS PostgreSQL (db.t3.micro): ~$13/mes

- Multi-AZ: +100% (~$26/mes total)

- Snapshots automatizados: ~$5/mes

- **Total RDS**: ~$31/mes

* *Potencial de Ahorro**: 38% con Reserved Instances
</Tab>
<Tab title="Almacenamiento y CDN">

* *Amazon S3**

- Almacenamiento Standard: ~$23/TB/mes

- ROMs y assets de juegos: estimado 50GB (~$1.15/mes)

- Transferencia de datos: ~$0.09/GB

* *CloudFront CDN**

- Primeros 1TB gratis/mes

- Costos adicionales: $0.085/GB

- **Total estimado**: ~$15-30/mes según tráfico
</Tab>
</Tabs>

### Herramientas de Monitorización

```yaml

# AWS Cost Explorer Query Example
cost_analysis:
  services:
    - service: "Amazon Elastic Kubernetes Service"
      monthly_cost: "$156"
      optimization_potential: "40-70%"
    - service: "Amazon RDS"
      monthly_cost: "$31"
      optimization_potential: "38%"
    - service: "Amazon S3"
      monthly_cost: "$15"
      optimization_potential: "60% (Intelligent Tiering)"

```

## 4.10.2. Estrategias de Optimización

### Reserved Instances para EKS

<Note>
Las Reserved Instances pueden reducir los costos de compute hasta un 40% comparado con instancias On-Demand.
</Note>

* *Implementación para Worker Nodes:**

```bash

# Análisis de uso actual
aws ce get-usage-and-cost \
  --time-period Start=2024-01-01,End=2024-02-01 \
  --granularity MONTHLY \
  --metrics BlendedCost \
  --group-by Type=DIMENSION,Key=INSTANCE_TYPE

# Recomendaciones de Reserved Instances
aws ce get-reservation-purchase-recommendation \
  --service EC2-Instance \
  --lookback-period-in-days 30 \
  --term-in-years 1

```

### Spot Instances para Cargas No Críticas

* *Configuración Spot Fleet para Workers:**

```yaml
apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: spot-provisioner
spec:
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["spot"]
    - key: node.kubernetes.io/instance-type
      operator: In
      values: ["t3.small", "t3.medium", "t3.large"]
  limits:
    resources:
      cpu: 100
      memory: 100Gi
  providerRef:
    name: nodepool
  ttlSecondsAfterEmpty: 30

```

### Optimización de Almacenamiento S3

* *Intelligent Tiering para ROMs:**

```bash

# Configurar Intelligent Tiering
aws s3api put-bucket-intelligent-tiering-configuration \
  --bucket retrogamecloud-roms \
  --id entire-bucket \
  --intelligent-tiering-configuration \
  Id=entire-bucket,Status=Enabled,Filter={},Tiering={Days=1,AccessTier=ARCHIVE_ACCESS},{Days=90,AccessTier=DEEP_ARCHIVE_ACCESS}

```

## 4.10.3. Automatización de Cost Management

### AWS Budgets y Alertas

```json
{
  "BudgetName": "RetroGameCloud-Monthly-Budget",
  "BudgetLimit": {
    "Amount": "500",
    "Unit": "USD"
  },
  "TimeUnit": "MONTHLY",
  "BudgetType": "COST",
  "CostFilters": {
    "Service": [
      "Amazon Elastic Kubernetes Service",
      "Amazon Relational Database Service",
      "Amazon Simple Storage Service"
    ]
  },
  "NotificationsWithSubscribers": [
    {
      "Notification": {
        "NotificationType": "ACTUAL",
        "ComparisonOperator": "GREATER_THAN",
        "Threshold": 80,
        "ThresholdType": "PERCENTAGE"
      },
      "Subscribers": [
        {
          "SubscriptionType": "EMAIL",
          "Address": "admin@retrogamecloud.com"
        }
      ]
    }
  ]
}

```

### Lambda para Optimización Automática

```python
import boto3
import json
from datetime import datetime, timedelta

def lambda_handler(event, context):
    """
    Función Lambda para optimización automática de costos
    """
    ec2 = boto3.client('ec2')
    rds = boto3.client('rds')

    # Identificar instancias subutilizadas
    unused_instances = identify_unused_instances(ec2)

    # Escalar RDS según uso
    optimize_rds_instances(rds)

    # Cleanup de snapshots antiguos
    cleanup_old_snapshots(ec2, rds)

    return {
        'statusCode': 200,
        'body': json.dumps('Optimización completada')
    }

def identify_unused_instances(ec2_client):
    """Identifica instancias EC2 con baja utilización"""
    cloudwatch = boto3.client('cloudwatch')

    instances = ec2_client.describe_instances()
    unused = []

    for reservation in instances['Reservations']:
        for instance in reservation['Instances']:
            if instance['State']['Name'] == 'running':
                # Verificar métricas de CPU últimos 7 días
                cpu_metrics = cloudwatch.get_metric_statistics(
                    Namespace='AWS/EC2',
                    MetricName='CPUUtilization',
                    Dimensions=[
                        {
                            'Name': 'InstanceId',
                            'Value': instance['InstanceId']
                        }
                    ],
                    StartTime=datetime.utcnow() - timedelta(days=7),
                    EndTime=datetime.utcnow(),
                    Period=3600,
                    Statistics=['Average']
                )

                if cpu_metrics['Datapoints']:
                    avg_cpu = sum(dp['Average'] for dp in cpu_metrics['Datapoints']) / len(cpu_metrics['Datapoints'])
                    if avg_cpu < 10:  # CPU menor al 10%
                        unused.append(instance['InstanceId'])

    return unused

```

## 4.10.4. Métricas y Dashboards

### CloudWatch Dashboard para Costos

```json
{
  "widgets": [
    {
      "type": "metric",
      "properties": {
        "metrics": [
          ["AWS/Billing", "EstimatedCharges", "Currency", "USD"]
        ],
        "period": 86400,
        "stat": "Maximum",
        "region": "eu-west-1",
        "title": "Estimated Monthly Charges"
      }
    },
    {
      "type": "metric",
      "properties": {
        "metrics": [
          ["AWS/EKS", "cluster_failed_request_count", "cluster_name", "retrogamecloud"]
        ],
        "period": 300,
        "stat": "Sum",
        "region": "eu-central-1",
        "title": "EKS Cluster Health"
      }
    }
  ]
}

```

### Terraform para Cost Anomaly Detection

```hcl
resource "aws_ce_anomaly_detector" "retrogamecloud_anomaly" {
  name         = "retrogamecloud-cost-anomaly"
  monitor_type = "DIMENSIONAL"

  specification = jsonencode({
    Dimension = {
      Key           = "SERVICE"
      Values        = ["Amazon Elastic Kubernetes Service", "Amazon RDS"]
      MatchOptions  = ["EQUALS"]
    }
  })
}

resource "aws_ce_anomaly_subscription" "retrogamecloud_anomaly_subscription" {
  name      = "retrogamecloud-anomaly-subscription"
  frequency = "DAILY"

  monitor_arn_list = [
    aws_ce_anomaly_detector.retrogamecloud_anomaly.arn
  ]

  subscriber {
    type    = "EMAIL"
    address = "admin@retrogamecloud.com"
  }

  threshold_expression {
    and {
      dimension {
        key           = "ANOMALY_TOTAL_IMPACT_ABSOLUTE"
        values        = ["100"]
        match_options = ["GREATER_THAN_OR_EQUAL"]
      }
    }
  }
}

```

## 4.10.5. Plan de Reducción de Costos

### Cronograma de Implementación

<Steps>
<Step title="Semana 1: Análisis Base">

- Implementar Cost Explorer detallado

- Configurar AWS Budgets y alertas

- Analizar patrones de uso actuales
</Step>

<Step title="Semana 2-3: Optimizaciones Inmediatas">

- Migrar a Reserved Instances para cargas predecibles

- Implementar Spot Instances para workers no críticos

- Configurar S3 Intelligent Tiering
</Step>

<Step title="Semana 4: Automatización">

- Desplegar Lambda de optimización automática

- Configurar Cost Anomaly Detection

- Implementar auto-scaling mejorado
</Step>

<Step title="Evaluación Mensual">

- Revisar métricas de ahorro

- Ajustar estrategias según patrones de uso

- Optimizar configuraciones basadas en datos
</Step>
</Steps>

### ROI Esperado

<Warning>

* *Proyección de Ahorro Mensual:**

- EKS Compute: $62-109 (40-70% de $156)

- RDS Reserved: $12 (38% de $31)

- S3 Intelligent Tiering: $9 (60% de $15)

- **Total ahorro estimado: $83-130/mes**
</Warning>

## 4.10.6. Mejores Prácticas

### Governance y Policies

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances"
      ],
      "Resource": "arn:aws:ec2:*:*:instance/*",
      "Condition": {
        "ForAllValues:StringNotEquals": {
          "ec2:InstanceType": [
            "t3.nano",
            "t3.micro",
            "t3.small",
            "t3.medium"
          ]
        }
      }
    }
  ]
}

```

### Tagging Strategy para Cost Allocation

```yaml

# Terraform tagging example
locals {
  common_tags = {
    Project     = "RetroGameCloud"
    Environment = var.environment
    Owner       = "platform-team"
    CostCenter  = "infrastructure"
    Backup      = "required"
  }
}

resource "aws_instance" "worker_node" {
  # ... configuración de instancia

  tags = merge(local.common_tags, {
    Name = "rgc-worker-${count.index}"
    Role = "kubernetes-worker"
    Tier = "compute"
  })
}

```

Con estas estrategias de optimización, RetroGameCloud puede reducir significativamente sus costos de AWS mientras mantiene la performance y disponibilidad del servicio.