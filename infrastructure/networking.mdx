---
title: 6.3. Networking y Seguridad
description: Arquitectura de red VPC, subnets, security groups y topología de red
icon: network-wired
---

## Arquitectura de Red

Retro Game Hub utiliza una VPC dedicada con subnets públicas y privadas distribuidas en 3 zonas de disponibilidad para alta disponibilidad.

## Configuración de VPC

<CardGroup cols={3}>
  <Card title="CIDR Block" icon="network-wired">
    **10.0.0.0/16**

    65,536 IPs disponibles
  </Card>

  <Card title="Zonas" icon="server">
    **3 AZs**

    Alta disponibilidad
  </Card>

  <Card title="Subnets" icon="diagram-project">
    **6 Subnets**

    3 públicas + 3 privadas
  </Card>
</CardGroup>

## Topología de Red

<Frame>
```mermaid
graph TB
    subgraph "Internet"
        IGW[Internet Gateway]
    end
    
    subgraph "VPC: 10.0.0.0/16"
        subgraph "Public Tier"
            direction TB
            ALB[Application Load Balancer]
            NAT1[NAT Gateway AZ-A]
            NAT2[NAT Gateway AZ-B]
            NAT3[NAT Gateway AZ-C]
            
            subgraph "Public Subnets"
                PUB1[Public 1<br/>10.0.1.0/24<br/>AZ-A]
                PUB2[Public 2<br/>10.0.2.0/24<br/>AZ-B]
                PUB3[Public 3<br/>10.0.3.0/24<br/>AZ-C]
            end
        end
        
        subgraph "Application Tier"
            subgraph "Private Subnets"
                PRIV1[Private 1<br/>10.0.11.0/24<br/>AZ-A]
                PRIV2[Private 2<br/>10.0.12.0/24<br/>AZ-B]
                PRIV3[Private 3<br/>10.0.13.0/24<br/>AZ-C]
            end
            
            subgraph "EKS Nodes"
                NODE1[Node Group AZ-A]
                NODE2[Node Group AZ-B]
                NODE3[Node Group AZ-C]
            end
        end
        
        subgraph "Database Tier"
            subgraph "DB Subnets"
                DB1[DB Subnet 1<br/>10.0.21.0/24<br/>AZ-A]
                DB2[DB Subnet 2<br/>10.0.22.0/24<br/>AZ-B]
            end
            
            RDS_PRIMARY[(RDS Primary<br/>AZ-A)]
            RDS_STANDBY[(RDS Standby<br/>AZ-B)]
            REDIS[(ElastiCache<br/>Redis)]
        end
    end
    
    IGW --> ALB
    ALB --> NODE1
    ALB --> NODE2
    ALB --> NODE3
    
    NAT1 --> IGW
    NAT2 --> IGW
    NAT3 --> IGW
    
    NODE1 --> NAT1
    NODE2 --> NAT2
    NODE3 --> NAT3
    
    NODE1 --> RDS_PRIMARY
    NODE2 --> RDS_PRIMARY
    NODE3 --> RDS_PRIMARY
    
    NODE1 --> REDIS
    NODE2 --> REDIS
    NODE3 --> REDIS
    
    RDS_PRIMARY <--> RDS_STANDBY
    
    PUB1 --> NAT1
    PUB2 --> NAT2
    PUB3 --> NAT3
    
    PRIV1 --> NODE1
    PRIV2 --> NODE2
    PRIV3 --> NODE3
    
    DB1 --> RDS_PRIMARY
    DB2 --> RDS_STANDBY
```
</Frame>

## Diseño de Subnets

### Subnets Públicas

Tienen acceso directo a Internet vía Internet Gateway.

<Table>
  <thead>
    <tr>
      <th>Subnet</th>
      <th>CIDR</th>
      <th>AZ</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**Public 1**</td>
      <td>10.0.1.0/24</td>
      <td>eu-west-1a</td>
      <td>ALB, NAT Gateway</td>
    </tr>
    <tr>
      <td>**Public 2**</td>
      <td>10.0.2.0/24</td>
      <td>eu-west-1b</td>
      <td>ALB, NAT Gateway</td>
    </tr>
    <tr>
      <td>**Public 3**</td>
      <td>10.0.3.0/24</td>
      <td>eu-west-1c</td>
      <td>ALB, NAT Gateway</td>
    </tr>
  </tbody>
</Table>

**Recursos en subnets públicas:**
- Application Load Balancer (ALB)
- NAT Gateway (uno por AZ)
- Bastion Host (opcional)

### Subnets Privadas

Sin acceso directo a Internet - salen a través del NAT Gateway.

<Table>
  <thead>
    <tr>
      <th>Subnet</th>
      <th>CIDR</th>
      <th>AZ</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**Private 1**</td>
      <td>10.0.11.0/24</td>
      <td>eu-west-1a</td>
      <td>EKS nodes</td>
    </tr>
    <tr>
      <td>**Private 2**</td>
      <td>10.0.12.0/24</td>
      <td>eu-west-1b</td>
      <td>EKS nodes</td>
    </tr>
    <tr>
      <td>**Private 3**</td>
      <td>10.0.13.0/24</td>
      <td>eu-west-1c</td>
      <td>EKS nodes</td>
    </tr>
  </tbody>
</Table>

### Subnets de Base de Datos

<Table>
  <thead>
    <tr>
      <th>Subnet</th>
      <th>CIDR</th>
      <th>AZ</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>**DB 1**</td>
      <td>10.0.21.0/24</td>
      <td>eu-west-1a</td>
      <td>RDS primary, ElastiCache</td>
    </tr>
    <tr>
      <td>**DB 2**</td>
      <td>10.0.22.0/24</td>
      <td>eu-west-1b</td>
      <td>RDS standby</td>
    </tr>
  </tbody>
</Table>

## Flujo de Tráfico

### Tráfico Entrante

<Frame>
```mermaid
sequenceDiagram
    participant U as Usuario
    participant CF as CloudFront
    participant ALB as Load Balancer
    participant EKS as EKS Pods
    participant RDS as Base de Datos
    
    U->>CF: 1. Solicitud HTTPS
    CF->>ALB: 2. Reenvío a ALB (público)
    ALB->>EKS: 3. Balanceo a pods (privado)
    EKS->>RDS: 4. Query DB (privado)
    RDS->>EKS: 5. Respuesta
    EKS->>ALB: 6. Respuesta HTTP
    ALB->>CF: 7. Respuesta
    CF->>U: 8. Respuesta al usuario
```
</Frame>

### Tráfico Saliente

<Frame>
```mermaid
sequenceDiagram
    participant EKS as EKS Pods
    participant NAT as NAT Gateway
    participant IGW as Internet Gateway
    participant EXT as Servicios Externos
    
    EKS->>NAT: 1. Solicitud saliente
    NAT->>IGW: 2. Traducción NAT
    IGW->>EXT: 3. Hacia Internet
    EXT->>IGW: 4. Respuesta
    IGW->>NAT: 5. Retorno
    NAT->>EKS: 6. Respuesta al pod
```
</Frame>

## Security Groups

### ALB Security Group

<Accordion title="alb-security-group">
```yaml
Inbound Rules:
  - Port: 80
    Protocol: HTTP
    Source: 0.0.0.0/0
    Description: "HTTP from anywhere"
  
  - Port: 443
    Protocol: HTTPS
    Source: 0.0.0.0/0
    Description: "HTTPS from anywhere"

Outbound Rules:
  - Port: 8080
    Protocol: HTTP
    Destination: eks-nodes-sg
    Description: "To EKS nodes"
```
</Accordion>

### EKS Nodes Security Group

<Accordion title="eks-nodes-security-group">
```yaml
Inbound Rules:
  - Port: 8080
    Protocol: HTTP
    Source: alb-security-group
    Description: "From ALB"
  
  - Port: 443
    Protocol: HTTPS
    Source: eks-control-plane-sg
    Description: "From EKS control plane"
  
  - Ports: 1025-65535
    Protocol: TCP
    Source: self
    Description: "Inter-node communication"

Outbound Rules:
  - Port: 443
    Protocol: HTTPS
    Destination: 0.0.0.0/0
    Description: "HTTPS to anywhere"
  
  - Port: 5432
    Protocol: TCP
    Destination: rds-security-group
    Description: "To PostgreSQL"
  
  - Port: 6379
    Protocol: TCP
    Destination: redis-security-group
    Description: "To Redis"
```
</Accordion>

### RDS Security Group

<Accordion title="rds-security-group">
```yaml
Inbound Rules:
  - Port: 5432
    Protocol: TCP
    Source: eks-nodes-sg
    Description: "From EKS nodes"

Outbound Rules:
  - None (managed by AWS)
```
</Accordion>

### Redis Security Group

<Accordion title="redis-security-group">
```yaml
Inbound Rules:
  - Port: 6379
    Protocol: TCP
    Source: eks-nodes-sg
    Description: "From EKS nodes"

Outbound Rules:
  - None (managed by AWS)
```
</Accordion>

## Network ACLs

### Subnet Pública - NACL

<Table>
  <thead>
    <tr>
      <th>Regla</th>
      <th>Tipo</th>
      <th>Protocolo</th>
      <th>Puerto</th>
      <th>Origen/Destino</th>
      <th>Acción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>100</td>
      <td>Inbound</td>
      <td>TCP</td>
      <td>80</td>
      <td>0.0.0.0/0</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>110</td>
      <td>Inbound</td>
      <td>TCP</td>
      <td>443</td>
      <td>0.0.0.0/0</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>120</td>
      <td>Inbound</td>
      <td>TCP</td>
      <td>1024-65535</td>
      <td>0.0.0.0/0</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>100</td>
      <td>Outbound</td>
      <td>TCP</td>
      <td>8080</td>
      <td>10.0.0.0/16</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>110</td>
      <td>Outbound</td>
      <td>TCP</td>
      <td>1024-65535</td>
      <td>0.0.0.0/0</td>
      <td>ALLOW</td>
    </tr>
  </tbody>
</Table>

### Subnet Privada - NACL

<Table>
  <thead>
    <tr>
      <th>Regla</th>
      <th>Tipo</th>
      <th>Protocolo</th>
      <th>Puerto</th>
      <th>Origen/Destino</th>
      <th>Acción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>100</td>
      <td>Inbound</td>
      <td>TCP</td>
      <td>8080</td>
      <td>10.0.0.0/16</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>110</td>
      <td>Inbound</td>
      <td>TCP</td>
      <td>443</td>
      <td>10.0.0.0/16</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>120</td>
      <td>Inbound</td>
      <td>TCP</td>
      <td>1024-65535</td>
      <td>0.0.0.0/0</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>100</td>
      <td>Outbound</td>
      <td>TCP</td>
      <td>443</td>
      <td>0.0.0.0/0</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>110</td>
      <td>Outbound</td>
      <td>TCP</td>
      <td>5432</td>
      <td>10.0.0.0/16</td>
      <td>ALLOW</td>
    </tr>
    <tr>
      <td>120</td>
      <td>Outbound</td>
      <td>TCP</td>
      <td>6379</td>
      <td>10.0.0.0/16</td>
      <td>ALLOW</td>
    </tr>
  </tbody>
</Table>

## Configuración de Routing

### Route Tables

<Tabs>
  <Tab title="Public Route Table">
    ```yaml
    Routes:
      - Destination: 10.0.0.0/16
        Target: local
        Description: "VPC internal routing"
      
      - Destination: 0.0.0.0/0
        Target: igw-xxx
        Description: "Internet Gateway
</Tab>
</Tabs>
```