---
title: Logging y Trazabilidad
description: 'Sistema de logs centralizado, structured logging y correlation IDs'
icon: file-lines
---

# Logging y Trazabilidad

Sistema centralizado de logs para RetroGameCloud con structured logging y correlación entre servicios.

## Stack de Logging

<CardGroup cols={2}>
  <Card title="CloudWatch Logs" icon="aws">
    Agregación centralizada
  </Card>
  
  <Card title="Structured JSON" icon="code">
    Logs parseables y buscables
  </Card>
  
  <Card title="Correlation IDs" icon="link">
    Trazabilidad entre servicios
  </Card>
  
  <Card title="Log Retention" icon="clock">
    30 días producción, 7 días desarrollo
  </Card>
</CardGroup>

## Structured Logging

### Node.js (Winston)

```javascript
const winston = require('winston');

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: {
    service: 'auth-service',
    environment: process.env.NODE_ENV
  },
  transports: [
    new winston.transports.Console(),
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// Uso
logger.info('User login successful', {
  userId: 'user-123',
  correlationId: req.headers['x-correlation-id'],
  duration: 234
});
```

### Python (structlog)

```python
import structlog

logger = structlog.get_logger()

logger.info(
    "user_login_successful",
    user_id="user-123",
    correlation_id=request.headers.get("x-correlation-id"),
    duration_ms=234
)
```

## Correlation IDs

### Implementación en API Gateway

```typescript
// Middleware para generar correlation ID
import { v4 as uuidv4 } from 'uuid';

export function correlationIdMiddleware(req, res, next) {
  req.correlationId = req.headers['x-correlation-id'] || uuidv4();
  res.setHeader('x-correlation-id', req.correlationId);
  
  // Agregar a todos los logs
  req.log = logger.child({ correlationId: req.correlationId });
  
  next();
}
```

## CloudWatch Insights Queries

### Top Errors

```
fields @timestamp, @message, level, error
| filter level = "error"
| stats count() by error
| sort count desc
| limit 10
```

### Latency por Endpoint

```
fields @timestamp, method, path, duration
| filter method = "GET"
| stats avg(duration), p95(duration), p99(duration) by path
| sort p99(duration) desc
```

### Buscar por Correlation ID

```
fields @timestamp, @message, service
| filter correlationId = "abc-123-def"
| sort @timestamp asc
```

## Retención y Costos

<Note>
Producción: 30 días retention. Desarrollo: 7 días. Logs archivados en S3 por 1 año con Glacier.
</Note>

---

Logging estructurado permite debugging eficiente y análisis de problemas en producción.
