---
title: 6.2. TopologÃ­a de Infraestructura AWS
description: TopologÃ­a completa de la infraestructura AWS para RetroGameCloud incluyendo
  VPC, subnets, security groups y servicios distribuidos en mÃºltiples AZ
icon: diagram-project
---

# TopologÃ­a de Infraestructura AWS

Esta pÃ¡gina documenta la arquitectura completa de AWS para la plataforma RetroGameCloud, mostrando todos los componentes de infraestructura distribuidos en mÃºltiples zonas de disponibilidad y sus interconexiones.

## Diagrama de TopologÃ­a Completa

```mermaid
graph TB
    subgraph Internet[Internet]
        U[ğŸ‘¥ Usuarios Globales]
        API_EXT[ğŸŒ APIs Externas]
        DEV[ğŸ‘¨â€ğŸ’» Desarrolladores]
    end

    subgraph Route53[ğŸŒ Route 53]
        DNS_MAIN[retrogame.cloud]
        DNS_API[api.retrogame.cloud]
        DNS_CDN[cdn.retrogame.cloud]
        DNS_HEALTH[Health Checks]
    end

    subgraph CloudFront[â˜ï¸ CloudFront Global]
        CF_WEB[Web Distribution<br/>Origin: S3/ALB]
        CF_API[API Distribution<br/>Origin: ALB]
        CF_ASSETS[Assets Distribution<br/>Origin: S3]
        CF_EDGE[Edge Locations<br/>Worldwide]
    end

    subgraph WAF[ğŸ›¡ï¸ AWS WAF]
        WAF_WEB[Web ACL<br/>DDoS Protection]
        WAF_API[API Protection<br/>Rate Limiting]
    end

    subgraph Region[ğŸ¢ us-east-1 Virginia]
        subgraph S3Global[ğŸ“¦ S3 Buckets]
            S3_WEB[Static Web Assets]
            S3_GAMES[Game ROMs/Files]
            S3_SAVES[Save States]
            S3_LOGS[Access Logs]
            S3_BACKUP[Database Backups]
        end

        subgraph VPC[ğŸ  VPC 10.0.0.0/16]
            subgraph IGW_SEC[Internet Gateway & Security]
                IGW[Internet Gateway]
                NACL[Network ACLs]
            end

            subgraph AZ1[ğŸ“ Availability Zone 1a]
                subgraph PUB1[ğŸŒ Public Subnet 10.0.1.0/24]
                    ALB1[ğŸ”„ ALB Primary<br/>Target Groups]
                    NAT1[ğŸšª NAT Gateway 1<br/>Elastic IP]
                    BASTION1[ğŸ–¥ï¸ Bastion Host]
                end
                subgraph PRIV1[ğŸ”’ Private Subnet 10.0.11.0/24]
                    EKS1[âš™ï¸ EKS Node Group 1<br/>t3.large instances]
                    subgraph PODS1[ğŸ“¦ Pods AZ-1a]
                        KONG1[ğŸ¦ Kong Gateway<br/>Replicas: 2]
                        AUTH1[ğŸ” Auth Service<br/>Replicas: 3]
                        GAME1[ğŸ® Game Service<br/>Replicas: 5]
                        PROFILE1[ğŸ‘¤ Profile Service<br/>Replicas: 2]
                        NOTIFICATION1[ğŸ“¢ Notification<br/>Replicas: 2]
                    end
                end
                subgraph DATA1[ğŸ—„ï¸ Data Subnet 10.0.21.0/24]
                    RDS1[ğŸ˜ RDS Primary<br/>PostgreSQL 15<br/>db.r6g.large]
                    REDIS1[âš¡ Redis Primary<br/>cache.r6g.large]
                end
            end

            subgraph AZ2[ğŸ“ Availability Zone 1b]
                subgraph PUB2[ğŸŒ Public Subnet 10.0.2.0/24]
                    ALB2[ğŸ”„ ALB Secondary]
                    NAT2[ğŸšª NAT Gateway 2<br/>Elastic IP]
                    BASTION2[ğŸ–¥ï¸ Bastion Host]
                end
                subgraph PRIV2[ğŸ”’ Private Subnet 10.0.12.0/24]
                    EKS2[âš™ï¸ EKS Node Group 2<br/>t3.large instances]
                    subgraph PODS2[ğŸ“¦ Pods AZ-1b]
                        KONG2[ğŸ¦ Kong Gateway<br/>Replicas: 2]
                        AUTH2[ğŸ” Auth Service<br/>Replicas: 2]
                        GAME2[ğŸ® Game Service<br/>Replicas: 5]
                        PROFILE2[ğŸ‘¤ Profile Service<br/>Replicas: 2]
                        NOTIFICATION2[ğŸ“¢ Notification<br/>Replicas: 2]
                    end
                end
                subgraph DATA2[ğŸ—„ï¸ Data Subnet 10.0.22.0/24]
                    RDS2[ğŸ˜ RDS Standby<br/>Read Replica]
                    REDIS2[âš¡ Redis Replica<br/>Read-only]
                end
            end

            subgraph AZ3[ğŸ“ Availability Zone 1c]
                subgraph PUB3[ğŸŒ Public Subnet 10.0.3.0/24]
                    NAT3[ğŸšª NAT Gateway 3<br/>Elastic IP]
                end
                subgraph PRIV3[ğŸ”’ Private Subnet 10.0.13.0/24]
                    EKS3[âš™ï¸ EKS Node Group 3<br/>t3.large instances]
                    subgraph PODS3[ğŸ“¦ Pods AZ-1c]
                        KONG3[ğŸ¦ Kong Gateway<br/>Replicas: 1]
                        AUTH3[ğŸ” Auth Service<br/>Replicas: 2]
                        GAME3[ğŸ® Game Service<br/>Replicas: 3]
                        BATCH[âš™ï¸ Batch Jobs<br/>Game Processing]
                    end
                end
                subgraph DATA3[ğŸ—„ï¸ Data Subnet 10.0.23.0/24]
                    BACKUP[ğŸ’¾ Backup Storage<br/>Cross-Region]
                end
            end

            subgraph EKS_CONTROL[â˜¸ï¸ EKS Control Plane]
                EKS_API[Kubernetes API<br/>Multi-AZ]
                EKS_ETCD[etcd Cluster<br/>Managed]
            end

            subgraph MONITORING[ğŸ“Š Monitoring & Logging]
                CW_LOGS[CloudWatch Logs]
                CW_METRICS[CloudWatch Metrics]
                XRAY[X-Ray Tracing]
            end

        end

        subgraph EXTERNAL_SERVICES[ğŸ”Œ External AWS Services]
            SES[ğŸ“§ SES<br/>Email Service]
            SNS[ğŸ“± SNS<br/>Notifications]
            SQS[ğŸ“¬ SQS<br/>Message Queues]
            SECRETS[ğŸ” Secrets Manager]
            PARAM[âš™ï¸ Parameter Store]
            KMS[ğŸ”‘ KMS<br/>Encryption Keys]
        end

    end

    %% Conexiones principales
    U --> DNS_MAIN
    U --> CF_WEB
    API_EXT --> CF_API
    DEV --> BASTION1

    DNS_MAIN --> CF_WEB
    DNS_API --> CF_API
    DNS_CDN --> CF_ASSETS

    CF_WEB --> WAF_WEB
    CF_API --> WAF_API
    WAF_WEB --> ALB1
    WAF_API --> ALB1

    ALB1 --> KONG1
    ALB1 --> KONG2
    ALB2 --> KONG3

    KONG1 --> AUTH1
    KONG1 --> GAME1
    KONG1 --> PROFILE1

    AUTH1 --> RDS1
    GAME1 --> RDS1
    GAME1 --> REDIS1
    PROFILE1 --> RDS1

    RDS1 --> RDS2
    REDIS1 --> REDIS2

    GAME1 --> S3_GAMES
    GAME1 --> S3_SAVES
    CF_ASSETS --> S3_WEB

    EKS1 --> NAT1
    EKS2 --> NAT2
    EKS3 --> NAT3

    NAT1 --> IGW
    NAT2 --> IGW
    NAT3 --> IGW

    %% Estilo de nodos
    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef data fill:#4CAF50,stroke:#2E7D32,stroke-width:2px,color:#fff
    classDef security fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff
    classDef compute fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef network fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff

    class CF_WEB,CF_API,CF_ASSETS,DNS_MAIN,DNS_API,DNS_CDN aws
    class RDS1,RDS2,REDIS1,REDIS2,S3_WEB,S3_GAMES,S3_SAVES data
    class WAF_WEB,WAF_API,BASTION1,BASTION2,KMS,SECRETS security
    class EKS1,EKS2,EKS3,KONG1,KONG2,KONG3,AUTH1,AUTH2,GAME1,GAME2 compute
    class ALB1,ALB2,NAT1,NAT2,NAT3,IGW network
```

## Security Groups y Reglas de TrÃ¡fico

### Matriz de Security Groups

```mermaid
graph TB
    subgraph SecurityGroups[ğŸ›¡ï¸ Security Groups Matrix]
        subgraph ALB_SG[ALB Security Group]
            ALB_IN[â¬‡ï¸ Inbound<br/>Port 80,443 from 0.0.0.0/0<br/>Health Check ports]
            ALB_OUT[â¬†ï¸ Outbound<br/>To EKS Worker SG<br/>Port 30000-32767]
        end
        
        subgraph EKS_SG[EKS Worker Nodes SG]
            EKS_IN[â¬‡ï¸ Inbound<br/>From ALB SG: 30000-32767<br/>From Control Plane: 443,10250<br/>Inter-node: All traffic]
            EKS_OUT[â¬†ï¸ Outbound<br/>To RDS SG: 5432<br/>To Redis SG: 6379<br/>Internet: 80,443]
        end
        
        subgraph RDS_SG[RDS Security Group]
            RDS_IN[â¬‡ï¸ Inbound<br/>From EKS SG: 5432<br/>From Bastion SG: 5432]
            RDS_OUT[â¬†ï¸ Outbound<br/>None (implicit deny)]
        end
        
        subgraph REDIS_SG[Redis Security Group]
            REDIS_IN[â¬‡ï¸ Inbound<br/>From EKS SG: 6379]
            REDIS_OUT[â¬†ï¸ Outbound<br/>None (implicit deny)]
        end
        
        subgraph BASTION_SG[Bastion Security Group]
            BASTION_IN[â¬‡ï¸ Inbound<br/>SSH: 22 from Admin IPs<br/>VPN: 1194 from Developers]
            BASTION_OUT[â¬†ï¸ Outbound<br/>To RDS: 5432<br/>To EKS: 22,443<br/>Internet: 80,443]
        end
    end
    
    ALB_SG --> EKS_SG
    EKS_SG --> RDS_SG
    EKS_SG --> REDIS_SG
    BASTION_SG --> RDS_SG
    BASTION_SG --> EKS_SG
```

## Flujos de TrÃ¡fico por Casos de Uso

### 1. Flujo de Usuario Web

```mermaid
sequenceDiagram
    participant U as ğŸ‘¥ Usuario
    participant CF as â˜ï¸ CloudFront
    participant S3 as ğŸ“¦ S3
    participant R53 as ğŸŒ Route53
    participant WAF as ğŸ›¡ï¸ WAF
    participant ALB as ğŸ”„ ALB
    participant K as ğŸ¦ Kong

    U->>R53: DNS Query: retrogame.cloud
    R53->>U: CNAME: CloudFront Distribution
    U->>CF: HTTPS Request
    CF->>S3: Get Static Assets (if not cached)
    S3->>CF: Return Assets
    CF->>U: Serve Cached Content
    
    Note over U,K: Para llamadas API dinÃ¡micas
    U->>CF: API Request: /api/games
    CF->>WAF: Forward Request
    WAF->>ALB: Allow Traffic (after validation)
    ALB->>K: Route to Kong Gateway
    K->>U: Response via ALB->WAF->CF
```

### 2. Flujo de Juego en Tiempo Real

```mermaid
sequenceDiagram
    participant U as ğŸ® Game Client
    participant CF as â˜ï¸ CloudFront
    participant ALB as ğŸ”„ ALB
    participant K as ğŸ¦ Kong
    participant G as ğŸ® Game Service
    participant R as âš¡ Redis
    participant S3 as ğŸ“¦ S3
    participant RDS as ğŸ˜ PostgreSQL

    U->>CF: Load Game Request
    CF->>ALB: Forward to Game API
    ALB->>K: Route Request
    K->>G: /api/games/{id}/load
    
    G->>RDS: Get Game Metadata
    RDS->>G: Game Info
    
    G->>R: Check Save State Cache
    alt Cache Hit
        R->>G: Return Cached State
    else Cache Miss
        G->>S3: Load Save State
        S3->>G: Save State Data
        G->>R: Cache Save State
    end
    
    G->>S3: Load Game ROM
    S3->>G: ROM Data
    G->>U: Complete Game State
    
    Note over U,G: Durante el juego
    loop Game Session
        U->>G: Game Input/Actions
        G->>R: Update Session State
        G->>U: Game Response
    end
    
    Note over G,S3: Al guardar
    G->>R: Cache New Save State
    G->>S3: Persist Save State
    G->>RDS: Update Save Metadata
```

### 3. Flujo de Datos de Monitoreo

```mermaid
graph LR
    subgraph SOURCES[ğŸ“Š Data Sources]
        ALB_LOGS[ALB Access Logs]
        EKS_LOGS[EKS Container Logs]
        APP_METRICS[Application Metrics]
        RDS_METRICS[RDS Performance]
    end
    
    subgraph COLLECTION[ğŸ“¥ Collection Layer]
        CW_AGENT[CloudWatch Agent]
        FLUENT[Fluentd DaemonSet]
        PROM[Prometheus]
    end
    
    subgraph STORAGE[ğŸ’¾ Storage & Processing]
        CW_LOGS[CloudWatch Logs]
        CW_METRICS[CloudWatch Metrics]
```