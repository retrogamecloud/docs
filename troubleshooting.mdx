---
title: 8.4. Soluci贸n de Problemas Comunes
description: Gu铆a de resoluci贸n de problemas comunes en Retro Game Hub para desarrollo
  y producci贸n
icon: file-lines
---

#  Troubleshooting

Gu铆a completa para diagnosticar y resolver problemas comunes en Retro Game Hub en entornos de desarrollo y producci贸n.

- --

##  Problemas de Desarrollo Local

### 1. Juego No Carga

#### S铆ntomas

- Pantalla negra despu茅s de seleccionar juego

- Mensaje "Error loading game"

- Barra de progreso se queda congelada

#### Diagn贸stico

```bash

# 1. Verificar que el archivo .jsdos existe en S3
aws s3 ls s3://retrogame-cdn-production/juegos/

# 2. Verificar permisos p煤blicos del bucket
aws s3api get-bucket-policy --bucket retrogame-cdn-production

# 3. Verificar CloudFront
aws cloudfront get-distribution --id E1XXXXXXXXXXXXX

# 4. Probar descarga directa
curl -I https://cdn.retrogamehub.games/juegos/doom.jsdos

```

#### Soluciones

* *A. Archivo no encontrado (404)**

```bash

# Subir el archivo faltante
aws s3 cp doom.jsdos s3://retrogame-cdn-production/juegos/

# Invalidar cach茅 de CloudFront
aws cloudfront create-invalidation \
  --distribution-id E1XXXXXXXXXXXXX \
  --paths "/juegos/doom.jsdos"

```

* *B. Problema de CORS**

```bash

# Verificar configuraci贸n CORS del bucket
aws s3api get-bucket-cors --bucket retrogame-cdn-production

# Aplicar pol铆tica CORS correcta
cat > cors.json <<EOF
{
  "CORSRules": [{
    "AllowedOrigins": ["https://retrogamehub.games"],
    "AllowedMethods": ["GET", "HEAD"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3600
  }]
}
EOF

aws s3api put-bucket-cors \
  --bucket retrogame-cdn-production \
  --cors-configuration file://cors.json

```

* *C. js-dos no inicializa**

```javascript
// Verificar en consola del navegador
console.log(typeof Dos); // Debe ser 'function'

// Si es undefined, verificar que js-dos.js est谩 cargado
<script src="jsdos/js-dos.js"></script>

```

### 2. Error de Autenticaci贸n

#### S铆ntomas

- Login falla con credenciales correctas

- Token JWT inv谩lido

- "Unauthorized" en requests autenticados

#### Diagn贸stico

```bash

# Verificar variables de entorno
echo $JWT_SECRET
echo $GITHUB_CLIENT_ID
echo $GITHUB_CLIENT_SECRET

# Verificar conectividad con GitHub OAuth
curl -I https://github.com/login/oauth/authorize

```

#### Soluciones

```bash

# Regenerar JWT secret
kubectl create secret generic jwt-secret \
  --from-literal=JWT_SECRET=$(openssl rand -base64 32) \
  --dry-run=client -o yaml | kubectl apply -f -

# Reiniciar auth service
kubectl rollout restart deployment auth-service

```

- --

##  Problemas de Producci贸n

### 1. Pod CrashLoopBackOff

#### S铆ntomas

- Pods se reinician continuamente

- Estado "CrashLoopBackOff" en kubectl get pods

- Aplicaci贸n no responde

#### Diagn贸stico

```bash

# Verificar estado de los pods
kubectl get pods -n retrogame

# Ver logs del pod problem谩tico
kubectl logs -f pod-name -n retrogame --previous

# Describir el pod para ver eventos
kubectl describe pod pod-name -n retrogame

```

#### Soluciones Comunes

* *A. Verificar secrets faltantes**

```bash

# Listar secrets disponibles
kubectl get secrets -n retrogame

# Verificar contenido del secret
kubectl describe secret app-secrets -n retrogame

# Crear secret faltante
kubectl create secret generic app-secrets \
  --from-literal=DATABASE_URL="postgresql://user:pass@host:5432/db" \
  --from-literal=REDIS_URL="redis://redis:6379"

```

* *B. Validar health checks**

```yaml

# Ajustar probe configuration en deployment
livenessProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 60  # Aumentar si la app tarda en iniciar
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 5

```

### 2. OOMKilled (Out of Memory)

#### S铆ntomas

- Pods terminan con c贸digo de salida 137

- "OOMKilled" en kubectl describe pod

- Performance degradada antes del crash

#### Diagn贸stico

```bash

# Verificar usage actual de memoria
kubectl top pods -n retrogame

# Ver historial de recursos
kubectl describe pod pod-name -n retrogame | grep -A 10 "Last State"

# Verificar l铆mites configurados
kubectl get pod pod-name -n retrogame -o yaml | grep -A 5 resources

```

#### Soluciones

* *A. Aumentar memory limits**

```yaml
resources:
  limits:
    memory: "1Gi"    # Aumentar de 512Mi
    cpu: "1000m"
  requests:
    memory: "512Mi"
    cpu: "500m"

```

* *B. Analizar memory leaks**

```bash

# Habilitar debugging en Node.js
kubectl set env deployment/app-service NODE_OPTIONS="--inspect=0.0.0.0:9229"

# Port forward para debugging
kubectl port-forward pod-name 9229:9229

# Usar Chrome DevTools para analizar heap

# chrome://inspect -> Configure -> Add localhost:9229

```

### 3. Latencia Alta en Base de Datos

#### S铆ntomas

- Respuestas lentas de la API (>2s)

- Timeouts en queries

- High CPU usage en RDS

#### Diagn贸stico

```bash

# Verificar slow queries con RDS Performance Insights
aws rds describe-db-instances --db-instance-identifier retrogame-prod

# Conectar a la base y verificar queries activas
psql $DATABASE_URL -c "SELECT pid, now() - pg_stat_activity.query_start AS duration, query FROM pg_stat_activity WHERE (now() - pg_stat_activity.query_start) > interval '5 minutes';"

```

#### Soluciones

* *A. Revisar 铆ndices faltantes**

```sql

- - Identificar queries sin 铆ndices
SELECT schemaname, tablename, attname, n_distinct, correlation
FROM pg_stats
WHERE tablename IN ('games', 'users', 'favorites')
ORDER BY n_distinct DESC;

- - Crear 铆ndices necesarios
CREATE INDEX CONCURRENTLY idx_games_category ON games(category);
CREATE INDEX CONCURRENTLY idx_favorites_user_game ON favorites(user_id, game_id);

```

* *B. Verificar connection pooling**

```javascript
// Configurar pgPool correctamente
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: 20,                    // m谩ximo de conexiones
  idleTimeoutMillis: 30000,   // timeout para conexiones idle
  connectionTimeoutMillis: 2000,
});

```

### 4. Error 502 Bad Gateway

#### S铆ntomas

- Kong devuelve 502 en requests

- "Bad Gateway" en navegador

- Intermitente o constante

#### Diagn贸stico

```bash

# Verificar estado de Kong
kubectl get pods -l app=kong -n kong

# Verificar logs de Kong
kubectl logs -f deployment/kong-proxy -n kong

# Verificar upstream health
kubectl exec -it deployment/kong-proxy -n kong -- kong health

```

#### Soluciones

* *A. Verificar Kong upstream health**

```bash

# Listar upstreams configurados
curl -s http://localhost:8001/upstreams

# Verificar targets de un upstream
curl -s http://localhost:8001/upstreams/api-service/targets

# Verificar health de targets
curl -s http://localhost:8001/upstreams/api-service/health

```

* *B. Revisar service endpoints**

```bash

# Verificar que los servicios tienen endpoints
kubectl get endpoints -n retrogame

# Verificar conectividad interna
kubectl run debug --image=busybox --rm -it --restart=Never -- nslookup api-service.retrogame.svc.cluster.local

```

### 5. OAuth2 Redirect Loops

#### S铆ntomas

- Login redirige infinitamente

- Error "redirect_uri_mismatch"

- Usuario no puede completar autenticaci贸n

#### Diagn贸stico

```bash

# Verificar configuraci贸n OAuth en GitHub
echo "GitHub OAuth App Settings:"
echo "Homepage URL: https://retrogamehub.games"
echo "Callback URL: https://retrogamehub.games/auth/callback"

# Verificar variables de entorno
kubectl get secret oauth-secrets -o yaml | base64 -d

```

#### Soluciones

* *A. Validar callback URLs**

```bash

# Verificar que las URLs coinciden exactamente

# En GitHub OAuth App:

# - Homepage URL: https://retrogamehub.games

# - Authorization callback URL: https://retrogamehub.games/auth/github/callback

# En el c贸digo:
GITHUB_CALLBACK_URL=https://retrogamehub.games/auth/github/callback

```

* *B. Verificar configuraci贸n de sesiones**

```javascript
// Configurar session correctamente
app.use(session({
  secret: process.env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  cookie: {
    secure: process.env.NODE_ENV === 'production', // true en producci贸n
    httpOnly: true,
    maxAge: 24 * 60 * 60 * 1000 // 24 horas
  }
}));

```

### 6. Agotamiento de Conexiones RDS

#### S铆ntomas

- "Too many connections" errors

- Nuevas conexiones fallan

- Degradaci贸n de performance

#### Diagn贸stico

```sql

- - Verificar conexiones activas
SELECT count(*) FROM pg_stat_activity;

- - Ver conexiones por estado
SELECT state, count(*)
FROM pg_stat_activity
WHERE state IS NOT NULL
GROUP BY state;

- - Identificar conexiones idle
SELECT pid, usename, application_name, state, query_start
FROM pg_stat_activity
WHERE state = 'idle'
ORDER BY query_start;

```

#### Soluciones

* *A. Configurar connection pooling**

```javascript
// Usar PgBouncer o configurar pool limits
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: parseInt(process.env.DB_POOL_MAX) || 10,  // Limitar por pod
  min: 2,
  acquire: 30000,
  idle: 10000
});

```

* *B. Aumentar max_connections en RDS**

```bash

# Modificar parameter group
aws rds modify-db-parameter-group \
  --db-parameter-group-name retrogame-params \
  --parameters "ParameterName=max_connections,ParameterValue=200,ApplyMethod=pending-reboot"

# Reiniciar instancia RDS
aws rds reboot-db-instance --db-instance-identifier retrogame-prod

```

- --

##  Herramientas de Monitoreo

### Comandos tiles

```bash

# Monitoreo general del cluster
kubectl top nodes
kubectl top pods -A

# Verificar eventos del cluster
kubectl get events --sort-by=.metadata.creationTimestamp

# Logs en tiempo real
kubectl logs -f -l app=api-service -n retrogame

# Verificar conectividad entre servicios
kubectl run debug --image=nicolaka/netshoot --rm -it --restart=Never

```

### Dashboards Recomendados

- **Grafana**: M茅tricas de infraestructura y aplicaci贸n

- **AWS CloudWatch**: Logs centralizados y m茅tricas de AWS

- **RDS Performance Insights**: An谩lisis detallado de queries

- **Kong Manager**: Estado y m茅tricas del API Gateway

- --

##  Escalaci贸n

Si los problemas persisten despu茅s de seguir esta gu铆a:

1. **Recopilar informaci贸n**: logs, m茅tricas, timeline del problema
2. **Verificar status pages**: GitHub Status, AWS Status
3. **Contactar al equipo de DevOps** con toda la informaci贸n relevante
4. **Documentar la resoluci贸n** para futuras referencias