---
title: "Casos de Uso End-to-End"
description: "Ejemplos completos de flujos de usuario desde el registro hasta el juego y clasificación"
icon: "route"
---

# Casos de Uso End-to-End

Esta guía proporciona ejemplos completos de flujos de usuario reales en RetroGameCloud, desde el registro inicial hasta jugar y guardar puntuaciones. Cada caso incluye las llamadas API exactas, respuestas y códigos de ejemplo.

## Flujo Completo de Usuario

### Diagrama del Flujo General

```mermaid
sequenceDiagram
    participant U as Usuario
    participant F as Frontend
    participant API as API Gateway
    participant A as Auth Service
    participant G as Game Service
    participant S as Score Service
    participant R as Ranking Service

    U->>F: 1. Registro
    F->>API: POST /api/auth/register
    API->>A: Validar y crear usuario
    A->>F: JWT Token
    
    U->>F: 2. Login
    F->>API: POST /api/auth/login
    API->>A: Validar credenciales
    A->>F: JWT Token
    
    F->>API: 3. Obtener catálogo
    API->>G: GET /api/games
    G->>F: Lista de juegos
    
    U->>F: 4. Seleccionar juego
    F->>API: GET /api/games/{slug}
    API->>G: Datos del juego
    G->>F: Configuración del juego
    
    U->>F: 5. Jugar
    F->>F: Cargar JS-DOS emulator
    
    U->>F: 6. Finalizar partida
    F->>API: POST /api/scores
    API->>S: Guardar puntuación
    S->>F: Confirmación
    
    F->>API: 7. Ver ranking
    API->>R: GET /api/rankings
    R->>F: Clasificación actualizada
```

## Caso 1: Registro de Usuario

### Solicitud HTTP

```bash
curl -X POST "https://api.retrogamecloud.com/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "jugador123",
    "email": "jugador@example.com",
    "password": "MiPassword123!",
    "confirm_password": "MiPassword123!"
  }'
```

### Respuesta Exitosa (201)

```json
{
  "success": true,
  "message": "Usuario registrado correctamente",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "username": "jugador123",
      "email": "jugador@example.com",
      "created_at": "2024-01-15T10:30:00Z",
      "email_verified": false
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "def502004c8a7e8b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z",
    "expires_in": 3600
  }
}
```

### Ejemplo en JavaScript

```javascript
const registrarUsuario = async (userData) => {
  try {
    const response = await fetch('/api/auth/register', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(userData)
    });
    
    const data = await response.json();
    
    if (data.success) {
      // Guardar token en localStorage
      localStorage.setItem('auth_token', data.data.token);
      localStorage.setItem('refresh_token', data.data.refresh_token);
      
      return data.data.user;
    }
    
    throw new Error(data.message);
  } catch (error) {
    console.error('Error en registro:', error);
    throw error;
  }
};
```

<Note>
El token JWT tiene una duración de 1 hora. Utiliza el `refresh_token` para obtener nuevos tokens sin requerir login.
</Note>

## Caso 2: Inicio de Sesión

### Solicitud HTTP

```bash
curl -X POST "https://api.retrogamecloud.com/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "jugador@example.com",
    "password": "MiPassword123!"
  }'
```

### Respuesta Exitosa (200)

```json
{
  "success": true,
  "message": "Login exitoso",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "username": "jugador123",
      "email": "jugador@example.com",
      "last_login": "2024-01-15T14:22:00Z",
      "games_played": 15,
      "total_score": 125600
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "abc123def456ghi789jkl012mno345pqr678stu901vwx234yz",
    "expires_in": 3600
  }
}
```

### Ejemplo con React Hook

```jsx
import { useState, useContext } from 'react';
import { AuthContext } from '../contexts/AuthContext';

const useAuth = () => {
  const [loading, setLoading] = useState(false);
  const { setUser, setToken } = useContext(AuthContext);
  
  const login = async (email, password) => {
    setLoading(true);
    
    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email, password })
      });
      
      const data = await response.json();
      
      if (data.success) {
        setToken(data.data.token);
        setUser(data.data.user);
        
        localStorage.setItem('auth_token', data.data.token);
        localStorage.setItem('refresh_token', data.data.refresh_token);
        
        return data.data.user;
      }
      
      throw new Error(data.message);
    } catch (error) {
      console.error('Error en login:', error);
      throw error;
    } finally {
      setLoading(false);
    }
  };
  
  return { login, loading };
};
```

## Caso 3: Obtener Catálogo de Juegos

### Solicitud HTTP

```bash
curl -X GET "https://api.retrogamecloud.com/api/games?page=1&limit=20&category=arcade" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### Respuesta Exitosa (200)

```json
{
  "success": true,
  "data": {
    "games": [
      {
        "id": "game_001",
        "slug": "prince-of-persia",
        "title": "Prince of Persia",
        "description": "Clásico juego de plataformas y aventura",
        "category": "adventure",
        "year": 1989,
        "publisher": "Broderbund",
        "thumbnail": "https://cdn.retrogamecloud.com/games/prince-of-persia/thumb.jpg",
        "screenshot": "https://cdn.retrogamecloud.com/games/prince-of-persia/screen.jpg",
        "file_size": "1.2MB",
        "downloads": 15420,
        "rating": 4.7,
        "tags": ["platformer", "adventure", "classic"],
        "playable": true
      },
      {
        "id": "game_002",
        "slug": "pac-man",
        "title": "Pac-Man",
        "description": "El icónico juego de laberinto",
        "category": "arcade",
        "year": 1980,
        "publisher": "Namco",
        "thumbnail": "https://cdn.retrogamecloud.com/games/pac-man/thumb.jpg",
        "screenshot": "https://cdn.retrogamecloud.com/games/pac-man/screen.jpg",
        "file_size": "256KB",
        "downloads": 28350,
        "rating": 4.9,
        "tags": ["arcade", "classic", "maze"],
        "playable": true
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 15,
      "total_games": 287,
      "games_per_page": 20
    },
    "filters": {
      "categories": ["arcade", "adventure", "rpg", "strategy", "sports"],
      "years": [1980, 1981, 1982, "...", 1995, 1996, 1997],
      "publishers": ["Namco", "Broderbund", "Sierra", "LucasArts"]
    }
  }
}
```

### Componente React para Catálogo

```jsx
import React, { useState, useEffect } from 'react';

const GameCatalog = () => {
  const [games, setGames] = useState([]);
  const [loading, setLoading] = useState(true);
  const [filters, setFilters] = useState({
    category: '',
    page: 1,
    limit: 20
  });

  useEffect(() => {
    fetchGames();
  }, [filters]);

  const fetchGames = async () => {
    setLoading(true);
    
    try {
      const queryParams = new URLSearchParams();
      Object.entries(filters).forEach(([key, value]) => {
        if (value) queryParams.append(key, value);
      });

      const response = await fetch(`/api/games?${queryParams}`, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });

      const data = await response.json();
      
      if (data.success) {
        setGames(data.data.games);
      }
    } catch (error) {
      console.error('Error cargando juegos:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="game-catalog">
      <div className="filters">
        <select 
          value={filters.category} 
          onChange={(e) => setFilters({...filters, category: e.target.value, page: 1})}
        >
          <option value="">Todas las categorías</option>
          <option value="arcade">Arcade</option>
          <option value="adventure">Aventura</option>
          <option value="rpg">RPG</option>
        </select>
      </div>

      {loading ? (
        <div className="loading">Cargando juegos...</div>
      ) : (
        <div className="games-grid">
          {games.map(game => (
            <GameCard key={game.id} game={game} />
          ))}
        </div>
      )}
    </div>
  );
};
```

## Caso 4: Cargar Juego Específico

### Solicitud HTTP

```bash
curl -X GET "https://api.retrogamecloud.com/api/games/prince-of-persia" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### Respuesta Exitosa (200)

```json
{
  "success": true,
  "data": {
    "game": {
      "id": "game_001",
      "slug": "prince-of-persia",
      "title": "Prince of Persia",
      "description": "Un joven debe rescatar a la princesa y reclamar el trono que le corresponde por derecho. Tienes 60 minutos antes de que la princesa sea forzada a casarse con el malvado Jaffar.",
      "category": "adventure",
      "year": 1989,
      "publisher": "Broderbund",
      "developer": "Jordan Mechner",
      "thumbnail": "https://cdn.retrogamecloud.com/games/prince-of-persia/thumb.jpg",
      "screenshots": [
        "https://cdn.retrogamecloud.com/games/prince-of-persia/screen1.jpg",
        "https://cdn.retrogamecloud.com/games/prince-of-persia/screen2.jpg",
        "https://cdn.retrogamecloud.com/games/prince-of-persia/screen3.jpg"
      ],
      "game_file": "https://cdn.retrogamecloud.com/games/prince-of-persia/game.zip",
      "file_size": "1.2MB",
      "emulator_config": {
        "type": "dosbox",
        "executable": "PRINCE.EXE",
        "memory": "4MB",
        "sound": "sb16",
        "cycles": "3000"
      },
      "controls": [
        { "action": "Mover izquierda", "key": "Flecha izquierda" },
        { "action": "Mover derecha", "key": "Flecha derecha" },
        { "action": "Saltar", "key": "Flecha arriba" },
        { "action": "Agacharse", "key": "Flecha abajo" },
        { "action": "Espada", "key": "Shift" }
      ],
      "stats": {
        "downloads": 15420,
        "rating": 4.7,
        "total_ratings": 1245,
        "favorites": 892,
        "times_played_today": 45
      },
      "high_scores": [
        {
          "player": "RetroMaster",
          "score": 125000,
          "date": "2024-01-14T16:30:00Z"
        },
        {
          "player": "PrincePlayer",
          "score": 118500,
          "date": "2024-01-13T20:15:00Z"
        }
      ]
    }
  }
}
```

### Inicializar Emulador JS-DOS

```jsx
import React, { useEffect, useRef, useState } from 'react';

const GameEmulator = ({ gameData }) => {
  const canvasRef = useRef(null);
  const [dosbox, setDosbox] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (gameData && canvasRef.current) {
      initializeDosBox();
    }
  }, [gameData]);

  const initializeDosBox = async () => {
    try {
      setLoading(true);
      
      // Importar JS-DOS dinámicamente
      const { Dos } = await import('js-dos');
      
      // Configurar DosBox
      const dos = Dos(canvasRef.current, {
        wdosboxUrl: "/wdosbox.js",
        cycles: parseInt(gameData.emulator_config.cycles),
        autolock: false
      });

      // Descargar y ejecutar el juego
      dos.ready((fs, main) => {
        //
```