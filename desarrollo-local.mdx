---
title: 8.1. Desarrollo Local
description: Ejecuta Retro Game Hub en tu máquina local paso a paso
icon: laptop-code
---

## Introducción

Esta guía te lleva desde ejecutar un microservicio básico en Node.js hasta un cluster completo de Kubernetes. Progresarás a través de 4 niveles:

<Steps>
  <Step title="Nivel 1: Node.js Puro">
    Ejecutar servicios directamente con Node.js
  </Step>
  <Step title="Nivel 2: Docker">
    Containerizar servicios individuales
  </Step>
  <Step title="Nivel 3: Docker Compose">
    Orquestar todos los servicios localmente
  </Step>
  <Step title="Nivel 4: Minikube">
    Desplegar en Kubernetes local
  </Step>
</Steps>

---

## 8.1.1. Nivel 1: Node.js Puro

### Requisitos

```bash
node --version  # v18 o superior
npm --version   # v9 o superior
```

### Ejecutar el Servicio de Autenticación

<Steps>
  <Step title="Clonar y configurar">
    ```bash
    git clone https://github.com/retrogamecloud/infrastructure.git
    cd infrastructure

    # Instalar dependencias del auth-service
    cd auth-service
    npm install
    ```
  </Step>

  <Step title="Configurar variables de entorno">
    Crea un archivo `.env`:
    ```bash
    # Base de datos (usar SQLite para testing local)
    DB_HOST=localhost
    DB_PORT=5432
    DB_NAME=retrogame_dev
    DB_USER=postgres
    DB_PASSWORD=postgres

    # JWT
    JWT_SECRET=mi-secreto-super-seguro-cambiar-en-produccion
    JWT_EXPIRATION=24h

    # Puerto del servicio
    PORT=3001
    ```
  </Step>

  <Step title="Iniciar PostgreSQL local (opcional)">
    Si tienes PostgreSQL instalado:
    ```bash
    # Crear base de datos
    createdb retrogame_dev

    # Ejecutar migraciones
    npm run migrate
    ```

    O usa SQLite para desarrollo rápido:
    ```javascript
    // En config/database.js
    module.exports = {
      development: {
        dialect: 'sqlite',
        storage: './dev.sqlite'
      }
    }
    ```
  </Step>

  <Step title="Ejecutar el servicio">
    ```bash
    npm run dev
    ```

    El servicio estará disponible en `http://localhost:3001`
  </Step>
</Steps>

### Probar el Servicio

```bash
# Registrar usuario
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"player1","email":"player@test.com","password":"123456"}'

# Iniciar sesión
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"player@test.com","password":"123456"}'
```

---

## 8.1.2. Nivel 2: Docker

### Construir Imagen del Servicio

<Steps>
  <Step title="Crear Dockerfile">
    ```dockerfile
    FROM node:18-alpine

    WORKDIR /app

    COPY package*.json ./
    RUN npm ci --only=production

    COPY . .

    EXPOSE 3001

    CMD ["npm", "start"]
    ```
  </Step>

  <Step title="Construir imagen">
    ```bash
    docker build -t retrogame/auth-service:dev .
    ```
  </Step>

  <Step title="Ejecutar container">
    ```bash
    docker run -p 3001:3001 \
      -e JWT_SECRET=mi-secreto-dev \
      -e DB_HOST=host.docker.internal \
      retrogame/auth-service:dev
    ```
  </Step>
</Steps>

---

## 8.1.3. Nivel 3: Docker Compose

### Configuración Completa

Crea `docker-compose.dev.yml`:

```yaml
version: '3.8'

services:
  # Base de datos
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: retrogame_dev
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Cache Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data

  # Servicio de Autenticación
  auth-service:
    build:
      context: ./auth-service
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=retrogame_dev
      - DB_USER=postgres
      - DB_PASSWORD=postgres
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=mi-secreto-super-seguro-dev
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_started
    volumes:
      - ./auth-service:/app
      - /app/node_modules

  # Servicio de Juegos
  game-service:
    build:
      context: ./game-service
      dockerfile: Dockerfile
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
      - DB_HOST=postgres
      - REDIS_URL=redis://redis:6379
      - AUTH_SERVICE_URL=http://auth-service:3001
    depends_on:
      - postgres
      - redis
      - auth-service
    volumes:
      - ./game-service:/app
      - /app/node_modules

  # API Gateway
  api-gateway:
    build:
      context: ./api-gateway
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - AUTH_SERVICE_URL=http://auth-service:3001
      - GAME_SERVICE_URL=http://game-service:3002
      - USER_SERVICE_URL=http://user-service:3003
    depends_on:
      - auth-service
      - game-service
    volumes:
      - ./api-gateway:/app
      - /app/node_modules

  # Frontend de Desarrollo
  frontend-dev:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    ports:
      - "8080:8080"
    environment:
      - VUE_APP_API_URL=http://localhost:3000
    volumes:
      - ./frontend:/app
      - /app/node_modules

volumes:
  postgres_data:
  redis_data:
```

### Ejecutar el Stack Completo

<Steps>
  <Step title="Iniciar servicios">
    ```bash
    docker-compose -f docker-compose.dev.yml up -d
    ```
  </Step>

  <Step title="Ver logs">
    ```bash
    # Todos los servicios
    docker-compose -f docker-compose.dev.yml logs -f

    # Servicio específico
    docker-compose -f docker-compose.dev.yml logs -f auth-service
    ```
  </Step>

  <Step title="Ejecutar migraciones">
    ```bash
    docker-compose -f docker-compose.dev.yml exec auth-service npm run migrate
    docker-compose -f docker-compose.dev.yml exec game-service npm run migrate
    ```
  </Step>

  <Step title="Acceder a la aplicación">
    - API Gateway: http://localhost:3000
    - Frontend: http://localhost:8080
    - PostgreSQL: localhost:5432
    - Redis: localhost:6379
  </Step>
</Steps>

---

## 8.1.4. Nivel 4: Minikube

### Preparar Kubernetes Local

<Steps>
  <Step title="Instalar herramientas">
    ```bash
    # Instalar kubectl
    curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
    sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

    # Instalar minikube
    curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    sudo install minikube /usr/local/bin/
    ```
  </Step>

  <Step title="Iniciar cluster">
    ```bash
    # Iniciar minikube con configuración para desarrollo
    minikube start --driver=docker --cpus=4 --memory=8192 --disk-size=20g

    # Habilitar addons útiles
    minikube addons enable dashboard
    minikube addons enable ingress
    minikube addons enable metrics-server
    ```
  </Step>

  <Step title="Configurar entorno Docker">
    ```bash
    # Usar Docker daemon de minikube para construir imágenes
    eval $(minikube docker-env)

    # Construir imágenes en minikube
    docker build -t retrogame/auth-service:dev ./auth-service
    docker build -t retrogame/game-service:dev ./game-service
    docker build -t retrogame/api-gateway:dev ./api-gateway
    ```
  </Step>
</Steps>

### Desplegar en Kubernetes

Crea los manifiestos en `k8s/dev/`:

```yaml
# k8s/dev/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: retrogame-dev
---
# k8s/dev/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: retrogame-dev
data:
  DB_HOST: "postgres-service"
  DB_PORT: "5432"
  DB_NAME: "retrogame_dev"
  REDIS_URL: "redis://redis-service:6379"
---
# k8s/dev/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: retrogame-dev
type: Opaque
data:
  DB_USER: cG9zdGdyZXM=  # postgres
  DB_PASSWORD: cG9zdGdyZXM=  # postgres  
  JWT_SECRET: bWktc2VjcmV0by1zdXBlci1zZWd1cm8tZGV2  # mi-secreto-super-seguro-dev
```

### Aplicar Configuraciones

<Steps>
  <Step title="Aplicar manifiestos base">
    ```bash
    kubectl apply -f k8s/dev/namespace.yaml
    kubectl apply -f k8s/dev/configmap.yaml
    kubectl apply -f k8s/dev/secrets.yaml
    ```
  </Step>

  <Step title="Desplegar base de datos">
    ```bash
    kubectl apply -f k8s/dev/postgres.yaml
    kubectl apply -f k8s/dev/redis.yaml
    ```
  </Step>

  <Step title="Desplegar servicios">
    ```bash
    kubectl apply -f k8s/dev/auth-service.yaml
    kubectl apply -f k8s/dev/game-service.yaml
    kubectl apply -f k8s/dev/api-gateway.yaml
    ```
  </Step>

  <Step title="Verificar despliegue">
    ```bash
    # Ver pods
    kubectl get pods -n retrogame-dev

    # Ver servicios
    kubectl get services -n retrogame-dev

    # Ver logs
    kubectl logs -f deployment/auth-service -n retrogame-dev
    ```
  </Step>
</Steps>

### Acceder a la Aplicación

```bash
# Obtener URL del servicio
minikube service api-gateway-service -n retrogame-dev --url

# Abrir dashboard de Kubernetes
minikube dashboard

# Port forwarding para desarrollo
kubectl port-forward service/api-gateway-service 3000:3000 -n retrogame-dev
```

---

## 8.1.5. Herramientas de Desarrollo

### Scripts Útiles

Crea `scripts/dev-tools.sh`:

```bash
#!/bin/bash

# Función para reiniciar un servicio específico
restart_service() {
  local service=$1
  echo "Reiniciando $service..."
  docker-compose -f docker-compose.dev.yml restart $service
}

# Función para ver logs en tiempo real
logs() {
  local service=${1:-""}
  if [ -z "$service" ]; then
    docker-compose -f docker-compose.dev.yml logs -f
  else
    docker-compose -f docker-compose.dev.yml logs -f $service
  fi
}

# Función para ejecutar migraciones
migrate() {
  echo "Ejecutando migraciones..."
  docker-compose -f docker-compose.dev.yml exec auth-service npm run migrate
  docker-compose -f docker-compose.dev.yml exec game-service npm run migrate
}

# Función para limpiar datos de desarrollo
clean_data() {
  echo "Limpiando datos de desarrollo..."
  docker-compose -f docker-compose.dev.yml down -v
  docker volume prune -f
}

# Parsear argumentos
case "$1" in
  restart)
    restart_service $2
    ;;
  logs)
    logs $2
    ;;
  migrate)
    migrate
    ;;
  clean)
    clean_data
    ;;
  *)
    echo "Uso: $0 {restart|logs|migrate|clean} [service]"
    exit 1
esac
```

### Configuración de VS Code

Crea `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Auth Service",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/auth-service/src/server.js",
      "env": {
        "NODE_ENV": "development",
        "DB_HOST": "localhost",
        "JWT_SECRET": "debug-secret"
      },
      "console": "integratedTerminal"
    },
    {
      "name": "Attach to Docker",
      "type": "node",
      "request": "attach",
      "port": 9229,
      "address": "localhost",
      "localRoot": "${workspaceFolder}",
      "remoteRoot": "/app"
    }
  ]
}
```

---

## 8.1.6. Troubleshooting Común

### Problemas de Puerto

```bash
# Ver qué proceso usa un puerto
lsof -i :3001

# Matar proceso en puerto específico
kill -9 $(lsof -t -i:3001)
```

### Problemas con Docker

```bash
# Limpiar contenedores parados
docker container prune -f

# Limpiar imágenes sin usar
docker image prune -f

# Reiniciar Docker completamente
sudo systemctl restart docker
```

### Problemas con Minikube

```bash
# Reiniciar minikube
minikube stop
minikube start

# Limpiar completamente
minikube delete
minikube start
```

<Note>
Para troubleshooting avanzado, consulta la sección [8.4. Troubleshooting](/development/troubleshooting).
</Note>