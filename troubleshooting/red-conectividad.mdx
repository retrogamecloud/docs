---
title: Red y Conectividad
description: Troubleshooting de problemas de red, DNS, y conectividad entre servicios
icon: network-wired
---

# Troubleshooting de Red y Conectividad

Guía para diagnosticar y resolver problemas de conectividad en Kubernetes y AWS.

## Problemas Comunes

<CardGroup cols={2}>
  <Card title="DNS Failures" icon="globe">
    Resolución de nombres fallando
  </Card>

  <Card title="Network Policies" icon="shield">
    Políticas bloqueando tráfico
  </Card>

  <Card title="Service Discovery" icon="magnifying-glass">
    Servicios no accesibles
  </Card>

  <Card title="Timeout Errors" icon="clock">
    Conexiones expirando
  </Card>
</CardGroup>

## Diagnóstico de DNS

```bash

# Test DNS dentro del pod
kubectl exec -it <pod> -- nslookup kubernetes.default

# Test resolución de servicios
kubectl exec -it <pod> -- nslookup score-service.game-system.svc.cluster.local

# Verificar CoreDNS
kubectl get pods -n kube-system -l k8s-app=kube-dns

# Logs de CoreDNS
kubectl logs -n kube-system -l k8s-app=kube-dns

# Test desde debug pod
kubectl run debug --rm -it --image=busybox -- nslookup score-service

```

## Conectividad entre Pods

```bash

# Ping entre pods (si ICMP habilitado)
kubectl exec pod-a -- ping pod-b-ip

# Test HTTP
kubectl exec pod-a -- wget -O- http://score-service:8080/health

# Netcat test
kubectl exec pod-a -- nc -zv score-service 8080

# Telnet test
kubectl exec -it pod-a -- telnet score-service 8080

```

## Network Policies

```yaml

# Policy permisiva para debugging
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-debug
  namespace: game-system
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - {}
  egress:
  - {}

```

```bash

# Listar policies
kubectl get networkpolicies -n game-system

# Describir policy
kubectl describe networkpolicy <name> -n game-system

# Eliminar policy temporalmente
kubectl delete networkpolicy <name> -n game-system

```

## Service Discovery

```bash

# Verificar service endpoints
kubectl get endpoints score-service -n game-system

# Describir servicio
kubectl describe service score-service -n game-system

# Port forwarding para test
kubectl port-forward svc/score-service 8080:8080 -n game-system

# Logs del pod
kubectl logs -f deployment/score-service -n game-system

```

## Troubleshooting de Ingress

```bash

# Verificar Ingress
kubectl get ingress -n game-system

# Describir ingress
kubectl describe ingress api-ingress -n game-system

# Logs de Kong/Ingress Controller
kubectl logs -n kong deployment/kong-controller

# Test desde fuera del cluster
curl -v https://api.domain.com/health

```

## AWS VPC y Security Groups

```bash

# Listar security groups
aws ec2 describe-security-groups \
  --filters "Name=group-name,Values=*eks*"

# Verificar reglas
aws ec2 describe-security-group-rules \
  --filters "Name=group-id,Values=sg-xxxxx"

# VPC Flow Logs
aws ec2 describe-flow-logs

# Verificar route tables
aws ec2 describe-route-tables \
  --filters "Name=vpc-id,Values=vpc-xxxxx"

```

## RDS Connectivity

```bash

# Test conexión desde pod
kubectl run psql-test --rm -it --image=postgres:15 -- \
  psql -h rds-endpoint.amazonaws.com -U admin -d gamedb

# Verificar security group de RDS
aws rds describe-db-instances \
  --db-instance-identifier gamedb-prod \
  --query 'DBInstances[0].VpcSecurityGroups'

# Test desde EC2/bastion
psql -h rds-endpoint.amazonaws.com -U admin -d gamedb -c "SELECT 1"

```

## Load Balancer Health Checks

```bash

# Verificar target groups
aws elbv2 describe-target-health \
  --target-group-arn arn:aws:elasticloadbalancing:...

# Logs de ALB
aws logs filter-log-events \
  --log-group-name /aws/elasticloadbalancing/app/game-alb \
  --start-time $(date -d '1 hour ago' +%s)000

```

## Tcpdump en Kubernetes

```bash

# Capturar tráfico del pod
kubectl sniff <pod-name> -n game-system -o capture.pcap

# O manualmente con tcpdump
kubectl exec -it <pod> -- tcpdump -i eth0 -w /tmp/capture.pcap
kubectl cp <pod>:/tmp/capture.pcap ./capture.pcap

# Analizar con Wireshark localmente
wireshark capture.pcap

```

## Métricas de Red

```promql

# Errores de red
rate(container_network_transmit_errors_total[5m])

# Paquetes dropped
rate(container_network_receive_packets_dropped_total[5m])

# Latencia entre servicios
histogram_quantile(0.95,
  rate(http_request_duration_seconds_bucket[5m]))

# Conexiones activas
sum(rate(container_network_tcp_usage_total[5m]))

```

## Checklist de Troubleshooting

1. Verificar que el pod esté running
2. Test DNS resolution
3. Verificar service endpoints
4. Check network policies
5. Validar security groups
6. Review ingress configuration
7. Check application logs
8. Verify environment variables
9. Test conectividad directa (port-forward)
10. Revisar métricas de red

- --

La mayoría de problemas de conectividad se resuelven verificando DNS, security groups y network policies.
